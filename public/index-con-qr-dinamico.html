<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keyon Access System V3</title>

<!-- ========== TAILWIND CSS CDN ========== -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- ========== GOOGLE FONTS ========== -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

<!-- ========== CONFIGURACI√ìN TAILWIND ========== -->
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'deep': '#0a0f1a',
        'surface': '#111827',
        'surface-light': '#1f2937',
        'primary': '#06b6d4',
        'primary-dark': '#0891b2',
        'accent': '#8b5cf6',
        'accent-light': '#a78bfa',
        'success': '#10b981',
        'warning': '#f59e0b',
        'danger': '#ef4444',
        'text-main': '#f1f5f9',
        'text-muted': '#94a3b8',
        'border-subtle': 'rgba(255,255,255,0.08)',
      },
      fontFamily: {
        'jakarta': ['"Plus Jakarta Sans"', 'sans-serif'],
        'space': ['"Space Grotesk"', 'sans-serif'],
      },
      animation: {
        'fade-in': 'fadeIn 0.4s ease-out',
        'slide-in-left': 'slideInLeft 0.3s ease-out',
        'slide-in-right': 'slideInRight 0.3s ease-out',
        'slide-in-up': 'slideInUp 0.4s ease-out',
        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
        'float': 'float 6s ease-in-out infinite',
        'grid-move': 'gridMove 25s linear infinite',
        'cbtis-fade': 'cbtisBfade 22s infinite',
        'cbtis-grid': 'cbtisBgridMove 18s linear infinite',
        'cbtis-box-in': 'cbtisBboxIn 0.9s ease-out',
        'cbtis-glow': 'cbtisBglow 2.8s infinite ease-in-out',
      },
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideInLeft: {
          '0%': { opacity: '0', transform: 'translateX(-20px)' },
          '100%': { opacity: '1', transform: 'translateX(0)' },
        },
        slideInRight: {
          '0%': { opacity: '0', transform: 'translateX(20px)' },
          '100%': { opacity: '1', transform: 'translateX(0)' },
        },
        slideInUp: {
          '0%': { opacity: '0', transform: 'translateY(20px)' },
          '100%': { opacity: '1', transform: 'translateY(0)' },
        },
        pulseGlow: {
          '0%, 100%': { boxShadow: '0 0 20px rgba(6, 182, 212, 0.3)' },
          '50%': { boxShadow: '0 0 40px rgba(6, 182, 212, 0.6)' },
        },
        float: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' },
        },
        gridMove: {
          '0%': { backgroundPosition: '0 0' },
          '100%': { backgroundPosition: '100px 100px' },
        },
        cbtisBfade: {
          '0%': { opacity: '0' },
          '8%': { opacity: '1' },
          '34%': { opacity: '1' },
          '45%': { opacity: '0' },
          '100%': { opacity: '0' },
        },
        cbtisBgridMove: {
          '0%': { transform: 'translateY(0)' },
          '100%': { transform: 'translateY(70px)' },
        },
        cbtisBboxIn: {
          '0%': { transform: 'translateY(25px) scale(0.97)', opacity: '0' },
          '100%': { transform: 'translateY(0) scale(1)', opacity: '1' },
        },
        cbtisBglow: {
          '0%, 100%': { opacity: '0.15' },
          '50%': { opacity: '0.55' },
        },
      },
    }
  }
}
</script>

<style>
/* ========== ESTILOS BASE ========== */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(6, 182, 212, 0.3) transparent;
}
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.3); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(6, 182, 212, 0.5); }

/* Grid de fondo */
.bg-grid {
  background-image: 
    linear-gradient(rgba(6, 182, 212, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(6, 182, 212, 0.03) 1px, transparent 1px);
  background-size: 50px 50px;
}

/* Gradiente de fondo principal */
.bg-main-gradient {
  background: 
    radial-gradient(ellipse at 20% 0%, rgba(6, 182, 212, 0.15) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 100%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
    linear-gradient(180deg, #0a0f1a 0%, #111827 100%);
}

/* Efecto glass */
.glass {
  background: rgba(17, 24, 39, 0.8);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

/* Sidebar */
.sidebar {
  transition: width 0.3s ease, transform 0.3s ease;
}
.sidebar.collapsed { width: 80px; }
.sidebar.collapsed .sidebar-text { display: none; }
.sidebar.collapsed .sidebar-logo-text { display: none; }
.sidebar.collapsed .nav-item { justify-content: center; padding-left: 0; padding-right: 0; }

/* Mobile sidebar */
@media (max-width: 1024px) {
  .sidebar {
    position: fixed;
    z-index: 1000;
    transform: translateX(-100%);
  }
  .sidebar.mobile-open {
    transform: translateX(0);
  }
}

/* Animaciones de entrada para cards */
.card-animate {
  animation: slideInUp 0.4s ease-out;
  animation-fill-mode: both;
}
.card-animate:nth-child(1) { animation-delay: 0.05s; }
.card-animate:nth-child(2) { animation-delay: 0.1s; }
.card-animate:nth-child(3) { animation-delay: 0.15s; }
.card-animate:nth-child(4) { animation-delay: 0.2s; }

/* Input focus effect */
.input-glow:focus {
  box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2), 0 0 20px rgba(6, 182, 212, 0.1);
}

/* Bot√≥n con efecto */
.btn-primary {
  background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
  transition: all 0.2s ease;
}
.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px -10px rgba(6, 182, 212, 0.5);
}

/* CBTIS Slideshow delays */
.cbtisB-slideshow img:nth-child(1) { animation-delay: 0s; }
.cbtisB-slideshow img:nth-child(2) { animation-delay: 7s; }
.cbtisB-slideshow img:nth-child(3) { animation-delay: 14s; }

.cbtisB-gridIA {
  background-image:
    linear-gradient(rgba(255,255,255,0.12) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.12) 1px, transparent 1px);
  background-size: 70px 70px;
}

/* Login focus effect */
#login-code:focus + .login-focus {
  border-color: #06b6d4;
  box-shadow: 0 0 15px rgba(6, 182, 212, 0.5);
}

/* Overlay show class */
#overlay-login.show { display: flex !important; }
#mini-holo.show { opacity: 1 !important; transform: translateY(0) scale(1) !important; }

/* Asegurar que los paneles sean visibles cuando se muestran */
#panel-alumno, #panel-profesor, #panel-admin {
  background: transparent;
}

#panel-alumno[style*="display: block"],
#panel-alumno[style*="display:block"],
#panel-profesor[style*="display: block"],
#panel-profesor[style*="display:block"],
#panel-admin[style*="display: block"],
#panel-admin[style*="display:block"] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Main content siempre visible cuando app-layout est√° activo */
#app-layout[style*="display: block"] #main-content,
#app-layout[style*="display:block"] #main-content {
  display: block !important;
  visibility: visible !important;
}

/* Estilos para items de lista mini alumnos */
#lista-mini-alumnos li,
.mini-alumno-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: rgba(30, 41, 59, 0.6);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  color: #f1f5f9;
  font-size: 0.85rem;
  animation: slideInRight 0.3s ease;
}

#lista-mini-alumnos li::before,
.mini-alumno-item::before {
  content: '‚úì';
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, #10b981, #059669);
  border-radius: 50%;
  color: white;
  font-size: 0.7rem;
  font-weight: bold;
  flex-shrink: 0;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Hover en botones del mini overlay */
#btn-limpiar-overlay:hover {
  background: rgba(239, 68, 68, 0.25) !important;
}

#btn-finalizar-clase:hover {
  background: rgba(16, 185, 129, 0.25) !important;
}

/* ==========================================
   ESTILOS PANEL ADMIN PROFESIONAL
========================================== */

/* Stat Cards */
.stat-card {
  display: flex;
  align-items: center;
  gap: 16px;
  transition: all 0.3s ease;
}

.stat-card .card-icon {
  font-size: 2.5rem;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
}

.stat-card .card-content {
  display: flex;
  flex-direction: column;
}

.stat-card .card-value {
  font-size: 2rem;
  font-weight: 700;
  color: #f1f5f9;
  line-height: 1;
}

.stat-card .card-label {
  font-size: 0.875rem;
  color: #94a3b8;
  margin-top: 4px;
}

.stat-card.pulse-update {
  animation: pulseCard 0.5s ease;
}

@keyframes pulseCard {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
}

/* Actividad Item */
.actividad-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: rgba(30, 41, 59, 0.5);
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.05);
  animation: slideIn 0.3s ease forwards;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.actividad-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
}

.avatar-alumno { background: linear-gradient(135deg, #06b6d4, #0891b2); }
.avatar-profesor { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

.actividad-info {
  flex: 1;
  min-width: 0;
}

.actividad-nombre {
  display: block;
  color: #f1f5f9;
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.actividad-evento {
  display: block;
  color: #64748b;
  font-size: 0.75rem;
}

.actividad-hora {
  color: #06b6d4;
  font-size: 0.75rem;
  font-weight: 600;
  white-space: nowrap;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: #64748b;
}

.empty-icon {
  font-size: 3rem;
  display: block;
  margin-bottom: 12px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 0.9rem;
}

/* Table Styles */
.table-row-animate {
  animation: fadeInRow 0.3s ease forwards;
  opacity: 0;
}

@keyframes fadeInRow {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

.user-cell {
  display: flex;
  align-items: center;
  gap: 10px;
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 0.8rem;
}

/* Badges */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
}

.badge-alumno { background: rgba(6, 182, 212, 0.2); color: #06b6d4; }
.badge-profesor { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
.badge-evento { background: rgba(16, 185, 129, 0.2); color: #10b981; }
.badge-aula { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
.badge-activa { background: rgba(16, 185, 129, 0.2); color: #10b981; }
.badge-finalizada { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 6px;
}

.btn-icon {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-qr { background: rgba(6, 182, 212, 0.15); color: #06b6d4; }
.btn-qr:hover { background: rgba(6, 182, 212, 0.3); }

.btn-barcode { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
.btn-barcode:hover { background: rgba(139, 92, 246, 0.3); }

.btn-edit { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
.btn-edit:hover { background: rgba(245, 158, 11, 0.3); }

.btn-delete { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
.btn-delete:hover { background: rgba(239, 68, 68, 0.3); }

.btn-view { background: rgba(6, 182, 212, 0.15); color: #06b6d4; }
.btn-view:hover { background: rgba(6, 182, 212, 0.3); }

.btn-download { background: rgba(16, 185, 129, 0.15); color: #10b981; }
.btn-download:hover { background: rgba(16, 185, 129, 0.3); }

/* Session ID */
.session-id {
  font-family: 'Space Grotesk', monospace;
  font-size: 0.75rem;
  background: rgba(6, 182, 212, 0.1);
  padding: 4px 8px;
  border-radius: 6px;
  color: #06b6d4;
}

/* Alumnos Count */
.alumnos-count {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.count-number {
  font-size: 1.25rem;
  font-weight: 700;
  color: #f1f5f9;
}

.count-label {
  font-size: 0.7rem;
  color: #64748b;
}

/* Clase Activa Card */
.clase-activa-card {
  background: rgba(30, 41, 59, 0.6);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: fadeInCard 0.4s ease forwards;
  opacity: 0;
}

.clase-activa-card:hover {
  transform: translateY(-4px);
  border-color: rgba(6, 182, 212, 0.3);
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

@keyframes fadeInCard {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.clase-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.clase-profesor {
  display: flex;
  align-items: center;
  gap: 12px;
}

.profesor-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
}

.profesor-info {
  display: flex;
  flex-direction: column;
}

.profesor-nombre {
  color: #f1f5f9;
  font-weight: 600;
  font-size: 0.9rem;
}

.profesor-materia {
  color: #64748b;
  font-size: 0.75rem;
}

.clase-aula {
  background: rgba(245, 158, 11, 0.2);
  color: #f59e0b;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.clase-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 12px;
}

.stat-item {
  text-align: center;
  padding: 10px;
  border-radius: 10px;
}

.stat-presentes { background: rgba(16, 185, 129, 0.15); }
.stat-ba√±o { background: rgba(245, 158, 11, 0.15); }
.stat-ausentes { background: rgba(239, 68, 68, 0.15); }

.stat-value {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  color: #f1f5f9;
}

.stat-label {
  font-size: 0.7rem;
  color: #94a3b8;
}

.stat-presentes .stat-value { color: #10b981; }
.stat-ba√±o .stat-value { color: #f59e0b; }
.stat-ausentes .stat-value { color: #ef4444; }

.clase-footer {
  display: flex;
  justify-content: space-between;
  padding-top: 12px;
  border-top: 1px solid rgba(255,255,255,0.05);
}

.clase-horario, .clase-grupo {
  color: #64748b;
  font-size: 0.8rem;
}

/* Toast Notifications */
#toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 99999;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 20px;
  background: rgba(17, 24, 39, 0.95);
  backdrop-filter: blur(12px);
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  transform: translateX(120%);
  transition: transform 0.3s ease;
  min-width: 280px;
}

.toast.show {
  transform: translateX(0);
}

.toast-icon {
  font-size: 1.2rem;
}

.toast-message {
  color: #f1f5f9;
  font-size: 0.9rem;
}

.toast-success { border-left: 4px solid #10b981; }
.toast-error { border-left: 4px solid #ef4444; }
.toast-warning { border-left: 4px solid #f59e0b; }
.toast-info { border-left: 4px solid #06b6d4; }

/* Modal Styles */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 15, 26, 0.9);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.modal-overlay.show {
  opacity: 1;
}

.modal-confirm, .modal-edit, .modal-session {
  background: rgba(17, 24, 39, 0.98);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 24px;
  padding: 32px;
  max-width: 90%;
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal-overlay.show .modal-confirm,
.modal-overlay.show .modal-edit,
.modal-overlay.show .modal-session {
  transform: scale(1);
}

.modal-icon {
  font-size: 3rem;
  text-align: center;
  margin-bottom: 16px;
}

.modal-confirm h3, .modal-edit h3, .modal-session h3 {
  color: #f1f5f9;
  font-size: 1.25rem;
  text-align: center;
  margin-bottom: 8px;
}

.modal-confirm p {
  color: #94a3b8;
  text-align: center;
  margin-bottom: 24px;
}

.modal-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.btn-cancel {
  padding: 12px 24px;
  background: rgba(100, 116, 139, 0.2);
  border: 1px solid rgba(100, 116, 139, 0.3);
  border-radius: 12px;
  color: #94a3b8;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-cancel:hover {
  background: rgba(100, 116, 139, 0.3);
}

.btn-danger {
  padding: 12px 24px;
  background: rgba(239, 68, 68, 0.2);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 12px;
  color: #fca5a5;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-danger:hover {
  background: rgba(239, 68, 68, 0.3);
}

.btn-primary {
  padding: 12px 24px;
  background: linear-gradient(135deg, #06b6d4, #0891b2);
  border: none;
  border-radius: 12px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
}

/* Modal Edit Form */
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.btn-close-modal {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: rgba(255,255,255,0.1);
  border: none;
  color: #94a3b8;
  font-size: 1.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-close-modal:hover {
  background: rgba(255,255,255,0.2);
  color: #f1f5f9;
}

.modal-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.form-group label {
  display: block;
  color: #94a3b8;
  font-size: 0.875rem;
  margin-bottom: 8px;
}

.form-group input {
  width: 100%;
  padding: 12px 16px;
  background: rgba(30, 41, 59, 0.8);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  color: #f1f5f9;
  font-size: 1rem;
  box-sizing: border-box;
}

.form-group input:focus {
  outline: none;
  border-color: #06b6d4;
}

/* Resumen Aula */
.resumen-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.resumen-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: rgba(30, 41, 59, 0.5);
  border-radius: 12px;
}

.resumen-icon {
  font-size: 1.5rem;
}

.resumen-content {
  display: flex;
  flex-direction: column;
}

.resumen-label {
  font-size: 0.75rem;
  color: #64748b;
}

.resumen-value {
  font-size: 0.9rem;
  color: #f1f5f9;
  font-weight: 600;
}

.stats-bar {
  display: flex;
  height: 24px;
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 20px;
}

.stats-bar-item {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 30px;
  transition: width 0.3s ease;
}

.stats-bar-item span {
  font-size: 0.75rem;
  font-weight: 600;
  color: white;
}

.stats-bar-item.presentes { background: #10b981; }
.stats-bar-item.ba√±o { background: #f59e0b; }
.stats-bar-item.ausentes { background: #ef4444; }

.alumnos-mini-lista h4 {
  color: #f1f5f9;
  font-size: 0.9rem;
  margin-bottom: 12px;
}

.alumnos-scroll {
  max-height: 200px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.alumno-mini {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 0.8rem;
}

.alumno-mini.presente { background: rgba(16, 185, 129, 0.1); border-left: 3px solid #10b981; }
.alumno-mini.en-ba√±o { background: rgba(245, 158, 11, 0.1); border-left: 3px solid #f59e0b; }
.alumno-mini.ausente { background: rgba(239, 68, 68, 0.1); border-left: 3px solid #ef4444; }

.alumno-mini-nombre { color: #f1f5f9; }
.alumno-mini-estado { color: #64748b; }

.estado-clase {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 12px;
  color: #10b981;
  font-weight: 600;
  margin-top: 16px;
}

.estado-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #10b981;
  animation: pulse 2s infinite;
}

.clase-finalizada {
  text-align: center;
  padding: 40px;
}

.finalizada-icon {
  font-size: 4rem;
  display: block;
  margin-bottom: 16px;
}

.clase-finalizada h3 {
  color: #ef4444;
  margin-bottom: 12px;
}

.clase-finalizada p {
  color: #94a3b8;
  margin: 4px 0;
}

.empty-clases, .error-clases {
  text-align: center;
  padding: 60px 20px;
  color: #64748b;
}

.empty-clases .empty-icon, .error-clases .error-icon {
  font-size: 4rem;
  display: block;
  margin-bottom: 16px;
}

/* ==========================================
   ESTILOS PANTALLA LOGIN POR ESCANEO
========================================== */
#login-screen {
  font-family: 'Plus Jakarta Sans', sans-serif;
}

#qr-reader-login {
  transition: all 0.3s ease;
}

#qr-reader-login.camera-active {
  border-style: solid;
  border-color: rgba(6, 182, 212, 0.5);
  box-shadow: 0 0 30px rgba(6, 182, 212, 0.2);
}

#qr-reader-login video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 16px;
}

.lector-placeholder {
  text-align: center;
  padding: 40px;
}

.lector-icon {
  font-size: 4rem;
  display: block;
  margin-bottom: 16px;
  animation: pulse 2s infinite;
}

/* Botones de modo escaneo */
#btn-login-camara.active,
#btn-login-lector.active {
  background: rgba(6, 182, 212, 0.3);
  border-color: rgba(6, 182, 212, 0.5);
  color: #06b6d4;
}

/* Modal Admin */
#modal-admin-login {
  opacity: 0;
  transition: opacity 0.3s ease;
}

#modal-admin-login.show {
  opacity: 1;
}

#modal-admin-login > div {
  transform: scale(0.95);
  transition: transform 0.3s ease;
}

#modal-admin-login.show > div {
  transform: scale(1);
}

/* Bot√≥n cerrar sesi√≥n */
.btn-cerrar-sesion {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 12px 16px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
  border-radius: 12px;
  color: #fca5a5;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-cerrar-sesion:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.3);
}

/* Perfil en panel */
.perfil-card {
  background: rgba(30, 41, 59, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 20px;
  padding: 24px;
}

.perfil-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 700;
  color: white;
  margin: 0 auto 16px;
}

.perfil-avatar.alumno {
  background: linear-gradient(135deg, #06b6d4, #0891b2);
}

.perfil-avatar.profesor {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.perfil-avatar.admin {
  background: linear-gradient(135deg, #f59e0b, #d97706);
}

.perfil-nombre {
  font-size: 1.5rem;
  font-weight: 700;
  color: #f1f5f9;
  text-align: center;
  margin-bottom: 4px;
}

.perfil-tipo {
  font-size: 0.875rem;
  color: #94a3b8;
  text-align: center;
  margin-bottom: 20px;
}

.perfil-datos {
  display: grid;
  gap: 12px;
}

.perfil-dato {
  display: flex;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(30, 41, 59, 0.5);
  border-radius: 12px;
}

.perfil-dato-label {
  color: #64748b;
  font-size: 0.875rem;
}

.perfil-dato-valor {
  color: #f1f5f9;
  font-weight: 500;
}

/* Bot√≥n editar perfil */
.btn-editar-perfil {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  padding: 14px;
  margin-top: 20px;
  background: rgba(6, 182, 212, 0.15);
  border: 1px solid rgba(6, 182, 212, 0.3);
  border-radius: 12px;
  color: #06b6d4;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-editar-perfil:hover {
  background: rgba(6, 182, 212, 0.25);
}

/* ==========================================
   ESTILOS DASHBOARD PROFESOR
========================================== */

/* Tarjetas de estad√≠sticas */
#dashboard-profesor .glass {
  transition: all 0.3s ease;
}

#dashboard-profesor .glass:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

/* Animaci√≥n para las barras de progreso */
#prof-top-puntualidad .bg-success,
#prof-top-puntualidad .bg-warning,
#prof-top-puntualidad .bg-danger {
  animation: growWidth 0.8s ease-out;
}

@keyframes growWidth {
  from { width: 0; }
}

/* Items de actividad con animaci√≥n */
#prof-actividad-reciente .actividad-item {
  animation: slideInLeft 0.3s ease forwards;
}

/* Clases de hoy hover */
#prof-clases-hoy > div:hover {
  transform: translateX(4px);
}

/* Tabla historial */
#tabla-historial-profesor tr {
  transition: background 0.2s ease;
}

#tabla-historial-profesor tr:hover {
  background: rgba(6, 182, 212, 0.05);
}

/* Responsive para dashboard profesor */
@media (max-width: 768px) {
  #dashboard-profesor .grid-cols-2 {
    grid-template-columns: 1fr 1fr;
  }
  
  #dashboard-profesor .text-3xl {
    font-size: 1.5rem;
  }
}
</style>

<link rel="icon" type="image/png" href="assets/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
<link rel="shortcut icon" href="assets/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="Keyon" />
<link rel="manifest" href="assets/site.webmanifest" />
</head>

<body class="font-jakarta bg-deep text-text-main min-h-screen overflow-x-hidden">

<!-- =====================================================
   OVERLAY BIENVENIDA INSTITUCIONAL
===================================================== -->
<!-- =====================================================
   PANTALLA DE LOGIN POR ESCANEO
===================================================== -->
<div id="login-screen" class="fixed inset-0 bg-deep z-[20000] overflow-y-auto">
  <!-- Fondo animado -->
  <div class="fixed inset-0 bg-main-gradient bg-grid animate-grid-move opacity-50 pointer-events-none"></div>
  <div class="fixed inset-0 bg-gradient-to-t from-deep via-transparent to-transparent pointer-events-none"></div>
  
  <!-- Contenido principal -->
  <div class="relative z-10 w-full max-w-md mx-auto px-4 py-10 min-h-screen flex flex-col justify-center">
    <!-- Logo y t√≠tulo -->
    <div class="text-center mb-8">
      <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center shadow-lg shadow-primary/30">
        <span class="text-4xl">üîê</span>
      </div>
      <h1 class="text-3xl font-bold text-text-main mb-2">Keyon Access</h1>
      <p class="text-text-muted">Escanea tu c√≥digo para ingresar</p>
    </div>
    
    <!-- Card de escaneo -->
    <div class="glass rounded-3xl p-6 mb-6">
      <!-- Botones de modo -->
      <div class="flex gap-3 mb-6">
        <button id="btn-login-camara" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 bg-primary/20 text-primary border border-primary/30 hover:bg-primary/30">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          C√°mara
        </button>
        <button id="btn-login-lector" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 bg-surface-light text-text-muted border border-border-subtle hover:bg-surface-light/80">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
          </svg>
          Lector
        </button>
      </div>
      
      <!-- √Årea de escaneo -->
      <div id="qr-reader-login" class="w-full aspect-square bg-surface-light rounded-2xl border-2 border-dashed border-border-subtle flex items-center justify-center overflow-hidden">
        <div class="text-center p-6">
          <span class="text-6xl mb-4 block opacity-30">üì∑</span>
          <p class="text-text-muted text-sm">Selecciona un m√©todo de escaneo</p>
        </div>
      </div>
      
      <!-- Input oculto para lector f√≠sico -->
      <input type="text" id="input-lector-login" class="absolute opacity-0 pointer-events-none" style="position: absolute; left: -9999px;">
      
      <!-- Estado del escaneo -->
      <p id="login-scan-status" class="text-center text-text-muted text-sm mt-4">Selecciona un m√©todo de escaneo</p>
    </div>
    
    <!-- Separador -->
    <div class="flex items-center gap-4 mb-6">
      <div class="flex-1 h-px bg-border-subtle"></div>
      <span class="text-text-muted text-sm">o</span>
      <div class="flex-1 h-px bg-border-subtle"></div>
    </div>
    
    <!-- Bot√≥n acceso admin -->
    <button id="btn-login-admin" class="w-full py-4 px-6 glass rounded-xl font-medium text-warning border border-warning/30 hover:bg-warning/10 transition-all flex items-center justify-center gap-3">
      <span class="text-xl">üëë</span>
      Acceso Administrador
    </button>
    
    <!-- Footer -->
    <p class="text-center text-text-muted/50 text-xs mt-8">CBTis 001 ‚Äî Sistema de Control de Asistencia</p>
  </div>
</div>

<!-- =====================================================
   MODAL LOGIN ADMIN (Firebase Auth)
===================================================== -->
<div id="modal-admin-login" class="fixed inset-0 bg-deep/95 backdrop-blur-xl flex items-center justify-center z-[30000] hidden">
  <div class="glass rounded-3xl p-8 w-full max-w-sm mx-4 animate-slide-in-up">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold text-text-main flex items-center gap-2">
        <span>üëë</span> Acceso Admin
      </h2>
      <button id="btn-cerrar-admin-login" class="w-8 h-8 rounded-lg bg-surface-light hover:bg-danger/20 flex items-center justify-center text-text-muted hover:text-danger transition-all">
        ‚úï
      </button>
    </div>
    
    <form id="form-admin-login" class="space-y-4">
      <div>
        <label class="block text-text-muted text-sm mb-2">Correo electr√≥nico</label>
        <input type="email" id="admin-email" placeholder="admin@ejemplo.com" required
               class="w-full p-4 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-warning transition-all">
      </div>
      <div>
        <label class="block text-text-muted text-sm mb-2">Contrase√±a</label>
        <input type="password" id="admin-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
               class="w-full p-4 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-warning transition-all">
      </div>
      
      <div id="admin-login-error" class="text-danger text-sm text-center"></div>
      
      <button type="submit" class="w-full py-4 bg-gradient-to-r from-warning to-amber-500 rounded-xl text-white font-bold text-lg hover:shadow-lg hover:shadow-warning/30 transition-all">
        Ingresar
      </button>
    </form>
    
    <p class="text-center text-text-muted/50 text-xs mt-6">Autenticaci√≥n segura con Firebase</p>
  </div>
</div>

<!-- =====================================================
   OVERLAY DE ESCANEO (para uso dentro del sistema)
===================================================== -->
<div id="overlay" class="overlay fixed inset-0 bg-deep/95 backdrop-blur-md flex items-center justify-center z-[10000] hidden">
  <div id="overlay-content" class="text-center p-8 glass rounded-3xl max-w-lg w-[90%] animate-slide-in-up">
    <h2 id="overlay-titulo" class="text-2xl text-primary font-bold mb-6">üì∑ Escaneando QR...</h2>
    <div id="video-container">
      <div id="video" class="w-full aspect-[4/3] bg-surface-light border-2 border-primary/50 rounded-2xl mx-auto"></div>
    </div>
    <p id="overlay-scan-status" class="text-text-muted mt-6">Apunta el QR del alumno</p>
  </div>
</div>

<!-- =====================================================
   OVERLAY DE MENSAJES
===================================================== -->
<div id="overlay-msg" class="overlay fixed inset-0 bg-deep/95 backdrop-blur-md flex items-center justify-center z-[10001] hidden">
  <div class="overlay-content text-center p-10 glass rounded-3xl max-w-md animate-slide-in-up">
    <h2 id="overlay-msg-titulo" class="text-2xl text-success font-bold mb-4">‚úÖ Escaneo exitoso</h2>
    <p id="overlay-msg-info" class="text-text-main text-lg">Alumno registrado correctamente.</p>
  </div>
</div>

<!-- =====================================================
   LAYOUT PRINCIPAL CON SIDEBAR
===================================================== -->
<div id="app-layout" class="min-h-screen" style="display:none;">
  
  <!-- Fondo con gradiente y grid (capa inferior) -->
  <div class="fixed inset-0 bg-main-gradient bg-grid animate-grid-move -z-10"></div>
  
  <!-- Mobile Header -->
  <header class="lg:hidden fixed top-0 left-0 right-0 h-16 glass z-[200] flex items-center justify-between px-4">
    <button id="mobile-menu-btn" class="p-2 rounded-lg hover:bg-surface-light transition-colors">
      <svg class="w-6 h-6 text-text-main" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
    <span class="font-space font-bold text-lg text-primary">Keyon</span>
    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold" id="mobile-avatar">
      U
    </div>
  </header>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed top-0 left-0 h-full w-64 glass z-[150] flex flex-col">
    <!-- Logo -->
    <div class="p-6 border-b border-border-subtle">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center">
          <span class="text-white font-bold text-lg">K</span>
        </div>
        <span class="sidebar-logo-text font-space font-bold text-xl text-text-main">Keyon</span>
      </div>
    </div>

    <!-- Perfil en Sidebar -->
    <div class="p-4 border-b border-border-subtle">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold text-lg" id="user-avatar">
          ?
        </div>
        <div class="sidebar-text">
          <p class="font-semibold text-text-main text-sm truncate max-w-[140px]" id="user-name">Usuario</p>
          <p class="text-text-muted text-xs" id="user-role">Escanea para ingresar</p>
        </div>
      </div>
    </div>

    <!-- Navegaci√≥n -->
    <nav class="flex-1 p-4 overflow-y-auto">
      <ul class="space-y-2">
        <!-- Navegaci√≥n Alumno -->
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all active" data-section="dashboard-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            <span class="sidebar-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="generador-qr-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
            <span class="sidebar-text">Mi QR</span>
          </a>
        </li>
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="historial-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
            <span class="sidebar-text">Mi Historial</span>
          </a>
        </li>
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="calendario-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span class="sidebar-text">Calendario</span>
          </a>
        </li>
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="comunicacion-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            <span class="sidebar-text">Comunicaci√≥n</span>
            <span id="badge-mensajes-alumno" class="hidden ml-auto bg-danger text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </a>
        </li>
        <li class="nav-alumno" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="disciplina-alumno">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            <span class="sidebar-text">Disciplina</span>
          </a>
        </li>

        <!-- Navegaci√≥n Profesor -->
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all active" data-section="dashboard-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            <span class="sidebar-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="generador-qr-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
            <span class="sidebar-text">Mi QR</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="escaner-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span class="sidebar-text">Esc√°ner</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="clase-activa">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
            <span class="sidebar-text">Clase Activa</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="historial-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <span class="sidebar-text">Historial</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="comunicacion-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            <span class="sidebar-text">Comunicaci√≥n</span>
            <span id="badge-mensajes-profesor" class="hidden ml-auto bg-danger text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </a>
        </li>
        <li class="nav-profesor" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="reportar-profesor">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            <span class="sidebar-text">Reportar</span>
          </a>
        </li>

        <!-- Navegaci√≥n Admin -->
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="dashboard-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            <span class="sidebar-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="usuarios-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <span class="sidebar-text">Usuarios</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="registros-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
            <span class="sidebar-text">Registros</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="estadisticas-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span class="sidebar-text">Estad√≠sticas</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="comunicacion-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            <span class="sidebar-text">Comunicaci√≥n</span>
            <span id="badge-mensajes-admin" class="hidden ml-auto bg-danger text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="analisis-predictivo">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span class="sidebar-text">An√°lisis IA</span>
            <span class="ml-auto bg-accent/20 text-accent text-xs px-2 py-0.5 rounded-full">ü§ñ</span>
          </a>
        </li>
        <li class="nav-admin nav-prefecto" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="prefectura">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            <span class="sidebar-text">Prefectura</span>
            <span id="badge-incidencias" class="hidden ml-auto bg-warning text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
          </a>
        </li>
        <li class="nav-admin" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="horarios-admin">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span class="sidebar-text">Horarios</span>
          </a>
        </li>

        <!-- Navegaci√≥n Prefecto (rol espec√≠fico) -->
        <li class="nav-prefecto-only" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all active" data-section="prefectura">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            <span class="sidebar-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-prefecto-only" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="reportes-prefectura">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
            <span class="sidebar-text">Reportes</span>
          </a>
        </li>
        <li class="nav-prefecto-only" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="permisos-prefectura">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
            <span class="sidebar-text">Permisos</span>
          </a>
        </li>
        <li class="nav-prefecto-only" style="display:none;">
          <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-text-muted hover:text-text-main hover:bg-surface-light/50 transition-all" data-section="citatorios-prefectura">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            <span class="sidebar-text">Citatorios</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Footer Sidebar -->
    <div class="p-4 border-t border-border-subtle">
      <button id="btn-cerrar-sesion" class="btn-cerrar-sesion">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        <span class="sidebar-text">Cerrar Sesi√≥n</span>
      </button>
      
      <button id="btn-toggle-sidebar" class="hidden lg:flex mt-2 w-full items-center justify-center gap-2 px-4 py-2 rounded-xl text-text-muted hover:bg-surface-light/50 transition-all">
        <svg class="w-5 h-5 transition-transform" id="toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/></svg>
      </button>
    </div>
  </aside>

  <!-- Overlay para cerrar sidebar en mobile -->
  <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[140] hidden lg:hidden"></div>

  <!-- Main Content Area - LOS PANELES VAN AQU√ç DENTRO -->
  <div id="main-content" class="relative z-10 lg:ml-64 min-h-screen pt-20 lg:pt-8 transition-all duration-300">
    
    <!-- =====================================================
       PANEL ALUMNO
    ===================================================== -->
    <section id="panel-alumno" class="relative px-4 lg:px-8 py-6 lg:py-8 pb-20" style="display:none;">
      <!-- Header con perfil -->
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-8">
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-text-main">Panel del Alumno</h1>
          <p class="text-text-muted mt-1">Tu asistencia y estad√≠sticas personales</p>
        </div>
        <div class="flex items-center gap-4 p-4 glass rounded-2xl">
          <div class="w-14 h-14 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold text-xl">
            <span id="alumno-avatar">A</span>
          </div>
          <div>
            <p class="font-semibold text-text-main" id="alumno-perfil-nombre">Nombre Alumno</p>
            <p class="text-text-muted text-sm" id="alumno-perfil-grado">Grado y Grupo</p>
          </div>
        </div>
      </div>

      <!-- =====================================================
         DASHBOARD DEL ALUMNO
      ===================================================== -->
      <div id="dashboard-alumno" class="content-section">
        <!-- Tarjetas de estad√≠sticas -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <!-- Asistencia General -->
          <div class="glass rounded-2xl p-5 border-l-4 border-success card-animate">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Asistencia</p>
                <p class="text-3xl font-bold text-text-main mt-1"><span id="alumno-stat-asistencia">0</span>%</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-success/20 flex items-center justify-center">
                <span class="text-2xl">‚úÖ</span>
              </div>
            </div>
            <p class="text-xs text-success mt-2">Promedio general</p>
          </div>

          <!-- Puntualidad -->
          <div class="glass rounded-2xl p-5 border-l-4 border-primary card-animate" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Puntualidad</p>
                <p class="text-3xl font-bold text-text-main mt-1"><span id="alumno-stat-puntualidad">0</span>%</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
                <span class="text-2xl">‚è∞</span>
              </div>
            </div>
            <p class="text-xs text-primary mt-2">Llegaste a tiempo</p>
          </div>

          <!-- Clases Asistidas -->
          <div class="glass rounded-2xl p-5 border-l-4 border-accent card-animate" style="animation-delay: 0.2s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Clases</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="alumno-stat-clases">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center">
                <span class="text-2xl">üìö</span>
              </div>
            </div>
            <p class="text-xs text-accent mt-2">Total asistidas</p>
          </div>

          <!-- Salidas al Ba√±o -->
          <div class="glass rounded-2xl p-5 border-l-4 border-warning card-animate" style="animation-delay: 0.3s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Permisos Ba√±o</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="alumno-stat-bano">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-warning/20 flex items-center justify-center">
                <span class="text-2xl">üöΩ</span>
              </div>
            </div>
            <p class="text-xs text-warning mt-2">Este mes</p>
          </div>
        </div>

        <!-- Grid principal -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
          <!-- Gr√°fica de asistencia mensual -->
          <div class="xl:col-span-2 glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìà Mi Asistencia
              </h3>
              <select id="alumno-filtro-mes" class="text-xs bg-surface-light border border-border-subtle rounded-lg px-3 py-1.5 text-text-muted focus:outline-none">
                <option value="semana">√öltima semana</option>
                <option value="mes" selected>Este mes</option>
                <option value="semestre">Este semestre</option>
              </select>
            </div>
            <div style="position: relative; height: 220px; width: 100%;">
              <canvas id="alumno-grafica-asistencia"></canvas>
            </div>
          </div>

          <!-- Resumen r√°pido -->
          <div class="glass rounded-2xl p-6 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üìä Resumen del Mes
            </h3>
            <div class="space-y-4">
              <!-- Asistencias -->
              <div class="flex items-center justify-between p-3 bg-success/10 rounded-xl">
                <div class="flex items-center gap-3">
                  <span class="text-xl">‚úÖ</span>
                  <span class="text-sm text-text-main">Asistencias</span>
                </div>
                <span class="text-lg font-bold text-success" id="alumno-resumen-asistencias">0</span>
              </div>
              <!-- Faltas -->
              <div class="flex items-center justify-between p-3 bg-danger/10 rounded-xl">
                <div class="flex items-center gap-3">
                  <span class="text-xl">‚ùå</span>
                  <span class="text-sm text-text-main">Faltas</span>
                </div>
                <span class="text-lg font-bold text-danger" id="alumno-resumen-faltas">0</span>
              </div>
              <!-- Retardos -->
              <div class="flex items-center justify-between p-3 bg-warning/10 rounded-xl">
                <div class="flex items-center gap-3">
                  <span class="text-xl">‚ö†Ô∏è</span>
                  <span class="text-sm text-text-main">Retardos</span>
                </div>
                <span class="text-lg font-bold text-warning" id="alumno-resumen-retardos">0</span>
              </div>
              <!-- Permisos ba√±o -->
              <div class="flex items-center justify-between p-3 bg-primary/10 rounded-xl">
                <div class="flex items-center gap-3">
                  <span class="text-xl">üöΩ</span>
                  <span class="text-sm text-text-main">Permisos ba√±o</span>
                </div>
                <span class="text-lg font-bold text-primary" id="alumno-resumen-bano">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Segunda fila -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <!-- Actividad reciente -->
          <div class="glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                ‚ö° Mi Actividad Reciente
              </h3>
              <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-success"></span>
              </span>
            </div>
            <div id="alumno-actividad-reciente" class="space-y-2 max-h-[280px] overflow-y-auto">
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl block mb-2 opacity-30">‚ö°</span>
                <p class="text-sm">Sin actividad reciente</p>
              </div>
            </div>
          </div>

          <!-- Logros / Racha -->
          <div class="glass rounded-2xl p-6 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üèÜ Mis Logros
            </h3>
            <div id="alumno-logros" class="space-y-3">
              <!-- Racha de asistencia -->
              <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-xl border border-amber-500/20">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-2xl">
                  üî•
                </div>
                <div class="flex-1">
                  <p class="font-semibold text-text-main">Racha de Asistencia</p>
                  <p class="text-sm text-text-muted"><span id="alumno-racha" class="text-amber-400 font-bold">0</span> d√≠as consecutivos</p>
                </div>
              </div>
              
              <!-- Mejor mes -->
              <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-emerald-500/10 to-teal-500/10 rounded-xl border border-emerald-500/20">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-2xl">
                  ‚≠ê
                </div>
                <div class="flex-1">
                  <p class="font-semibold text-text-main">Asistencia Perfecta</p>
                  <p class="text-sm text-text-muted" id="alumno-logro-perfecto">Logra 100% en un mes</p>
                </div>
              </div>

              <!-- Puntualidad -->
              <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-blue-500/10 to-indigo-500/10 rounded-xl border border-blue-500/20">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center text-2xl">
                  ‚è±Ô∏è
                </div>
                <div class="flex-1">
                  <p class="font-semibold text-text-main">Siempre Puntual</p>
                  <p class="text-sm text-text-muted" id="alumno-logro-puntual">S√© puntual 10 veces seguidas</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Acciones r√°pidas -->
        <div class="mt-6 glass rounded-2xl p-6 card-animate">
          <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
            üöÄ Acciones R√°pidas
          </h3>
          <div class="flex flex-wrap gap-3">
            <button onclick="document.querySelector('[data-section=generador-qr-alumno]').click()" class="py-3 px-5 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
              Ver Mi QR
            </button>
            <button onclick="document.querySelector('[data-section=historial-alumno]').click()" class="py-3 px-5 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
              Ver Historial
            </button>
            <button onclick="document.querySelector('[data-section=calendario-alumno]').click()" class="py-3 px-5 bg-success/20 hover:bg-success/30 text-success rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
              Ver Calendario
            </button>
            <button onclick="exportarMiHistorial()" class="py-3 px-5 bg-warning/20 hover:bg-warning/30 text-warning rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Exportar
            </button>
          </div>
        </div>
      </div>

      <!-- =====================================================
         GENERADOR QR ALUMNO
      ===================================================== -->
      <div id="generador-qr-alumno" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <!-- Info del alumno -->
          <div class="glass rounded-2xl p-6 lg:p-8 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-6 flex items-center gap-2">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              Tu Informaci√≥n
            </h3>
            
            <!-- Datos del alumno logueado -->
            <div id="info-alumno-qr" class="space-y-4">
              <div class="flex items-center gap-4 p-4 bg-surface-light/50 rounded-xl">
                <div id="avatar-alumno-qr" class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white text-xl font-bold">
                  --
                </div>
                <div>
                  <p id="nombre-alumno-qr" class="text-lg font-bold text-text-main">Cargando...</p>
                  <p id="grado-alumno-qr" class="text-sm text-text-muted">--</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div class="p-4 bg-surface-light/30 rounded-xl">
                  <p class="text-xs text-text-muted mb-1">N√∫mero de Control</p>
                  <p id="control-alumno-qr" class="text-lg font-bold text-primary">--</p>
                </div>
                <div class="p-4 bg-surface-light/30 rounded-xl">
                  <p class="text-xs text-text-muted mb-1">WhatsApp</p>
                  <p id="whatsapp-alumno-qr" class="text-lg font-bold text-text-main">--</p>
                </div>
              </div>
            </div>

            <!-- Informaci√≥n de seguridad -->
            <div class="mt-6 p-4 bg-primary/10 border border-primary/20 rounded-xl">
              <h4 class="font-semibold text-primary flex items-center gap-2 mb-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                C√≥digo Din√°mico Anti-Trampas
              </h4>
              <p class="text-sm text-text-muted">
                Tu c√≥digo QR y de barras se regeneran autom√°ticamente cada <strong class="text-primary">30 segundos</strong>. 
                Esto evita que alguien m√°s use tu c√≥digo si lo compartiste.
              </p>
            </div>

            <!-- Instrucciones -->
            <div class="mt-4 p-4 bg-surface-light/30 rounded-xl">
              <h4 class="font-semibold text-text-main mb-2">üìã C√≥mo usar tu c√≥digo</h4>
              <ol class="text-sm text-text-muted space-y-1 list-decimal list-inside">
                <li>Muestra este QR o c√≥digo de barras al esc√°ner</li>
                <li>Espera a que el profesor lo escanee</li>
                <li>Si el c√≥digo expir√≥, espera unos segundos a que se regenere</li>
              </ol>
            </div>
          </div>

          <!-- QR Preview -->
          <div class="glass rounded-2xl p-6 lg:p-8 card-animate flex flex-col items-center justify-center">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
              Tu C√≥digo QR BETA
              <span class="ml-2 px-2 py-0.5 bg-success/20 text-success text-xs rounded-full flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                Din√°mico
              </span>
            </h3>
            
            <!-- Contenedor QR -->
            <div class="relative">
              <div id="alumno-qrcode" class="w-52 h-52 bg-white rounded-2xl flex items-center justify-center mb-2 transition-all duration-300 shadow-lg">
                <div class="text-center text-gray-400">
                  <svg class="w-12 h-12 mx-auto mb-2 opacity-50 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
                  <span class="text-sm">Generando...</span>
                </div>
              </div>
              <!-- Badge de seguridad -->
              <div class="absolute -top-2 -right-2 w-8 h-8 bg-success rounded-full flex items-center justify-center shadow-lg" id="qr-security-badge-alumno" style="display: none;">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              </div>
            </div>
            
            <!-- C√≥digo de barras -->
            <svg id="alumno-barcode" class="mt-2 max-w-full"></svg>
            
            <!-- Temporizador -->
            <div id="qr-timer-alumno" class="mt-3 text-center w-full">
              <div class="flex items-center justify-center gap-2 p-2 rounded-lg bg-primary/10 text-primary">
                <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span class="text-sm">Generando c√≥digo...</span>
              </div>
            </div>
            
            <!-- Bot√≥n descargar -->
            <button onclick="descargarQRAlumno()" class="mt-4 py-3 px-8 bg-success hover:bg-success/80 rounded-xl text-white font-semibold transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Descargar QR
            </button>
            
            <!-- Aviso -->
            <div class="mt-4 p-3 bg-warning/10 border border-warning/20 rounded-xl text-center max-w-xs">
              <p class="text-xs text-warning">
                ‚ö†Ô∏è <strong>Importante:</strong> El c√≥digo descargado expira r√°pidamente. Muestra siempre el c√≥digo en vivo de esta pantalla.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         HISTORIAL DEL ALUMNO
      ===================================================== -->
      <div id="historial-alumno" class="content-section hidden">
        <div class="glass rounded-2xl p-6 mb-6">
          <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
              üìã Mi Historial de Asistencia
            </h3>
            <div class="flex gap-3">
              <select id="filtro-historial-alumno-mes" class="px-4 py-2 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-accent">
                <option value="">Todos los meses</option>
              </select>
              <button onclick="exportarMiHistorial()" class="py-2 px-4 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                Exportar
              </button>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left text-text-muted text-sm border-b border-border-subtle">
                  <th class="pb-3 px-2 font-medium">Fecha</th>
                  <th class="pb-3 px-2 font-medium">Clase</th>
                  <th class="pb-3 px-2 font-medium">Profesor</th>
                  <th class="pb-3 px-2 font-medium">Entrada</th>
                  <th class="pb-3 px-2 font-medium">Ba√±o</th>
                  <th class="pb-3 px-2 font-medium">Estado</th>
                </tr>
              </thead>
              <tbody id="tabla-historial-alumno" class="text-sm">
                <tr>
                  <td colspan="6" class="py-8 text-center text-text-muted">
                    <span class="text-4xl block mb-2 opacity-30">üìã</span>
                    <p>No hay registros en tu historial</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- =====================================================
         CALENDARIO DEL ALUMNO
      ===================================================== -->
      <div id="calendario-alumno" class="content-section hidden">
        <div class="glass rounded-2xl p-6">
          <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
              üìÖ Calendario de Asistencia
            </h3>
            <div class="flex items-center gap-3">
              <button onclick="cambiarMesCalendario(-1)" class="p-2 hover:bg-surface-light rounded-lg transition-all">
                <svg class="w-5 h-5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
              </button>
              <span id="calendario-mes-actual" class="text-text-main font-medium min-w-[150px] text-center">Diciembre 2024</span>
              <button onclick="cambiarMesCalendario(1)" class="p-2 hover:bg-surface-light rounded-lg transition-all">
                <svg class="w-5 h-5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- Leyenda -->
          <div class="flex flex-wrap gap-4 mb-6 text-sm">
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-success"></div>
              <span class="text-text-muted">Asistencia</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-danger"></div>
              <span class="text-text-muted">Falta</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-warning"></div>
              <span class="text-text-muted">Retardo</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded bg-surface-light"></div>
              <span class="text-text-muted">Sin clase</span>
            </div>
          </div>

          <!-- Calendario Grid -->
          <div class="grid grid-cols-7 gap-2">
            <!-- Headers d√≠as -->
            <div class="text-center text-text-muted text-sm font-medium py-2">Dom</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">Lun</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">Mar</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">Mi√©</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">Jue</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">Vie</div>
            <div class="text-center text-text-muted text-sm font-medium py-2">S√°b</div>
            
            <!-- D√≠as del mes (se generan din√°micamente) -->
          </div>
          <div id="calendario-dias" class="grid grid-cols-7 gap-2 mt-2">
            <!-- Los d√≠as se generan con JS -->
          </div>

          <!-- Resumen del mes -->
          <div class="mt-6 pt-6 border-t border-border-subtle">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
              <div>
                <p class="text-2xl font-bold text-success" id="cal-asistencias">0</p>
                <p class="text-xs text-text-muted">Asistencias</p>
              </div>
              <div>
                <p class="text-2xl font-bold text-danger" id="cal-faltas">0</p>
                <p class="text-xs text-text-muted">Faltas</p>
              </div>
              <div>
                <p class="text-2xl font-bold text-warning" id="cal-retardos">0</p>
                <p class="text-xs text-text-muted">Retardos</p>
              </div>
              <div>
                <p class="text-2xl font-bold text-primary" id="cal-porcentaje">0%</p>
                <p class="text-xs text-text-muted">Asistencia</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         COMUNICACI√ìN DEL ALUMNO
      ===================================================== -->
      <div id="comunicacion-alumno" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          <!-- Panel de Avisos -->
          <div class="xl:col-span-2 glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üì¢ Avisos y Circulares
              </h3>
              <div class="flex gap-2">
                <button onclick="filtrarAvisos('todos')" class="filtro-aviso active px-3 py-1 text-xs bg-primary/20 text-primary rounded-lg transition-all">Todos</button>
                <button onclick="filtrarAvisos('institucional')" class="filtro-aviso px-3 py-1 text-xs bg-surface-light text-text-muted rounded-lg hover:bg-surface-light/70 transition-all">Instituci√≥n</button>
                <button onclick="filtrarAvisos('profesor')" class="filtro-aviso px-3 py-1 text-xs bg-surface-light text-text-muted rounded-lg hover:bg-surface-light/70 transition-all">Profesores</button>
              </div>
            </div>
            
            <div id="lista-avisos-alumno" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
              <!-- Los avisos se cargan din√°micamente -->
              <div class="text-center py-12 text-text-muted">
                <span class="text-5xl block mb-3 opacity-30">üì¢</span>
                <p>No hay avisos por el momento</p>
              </div>
            </div>
          </div>

          <!-- Panel de Chats -->
          <div class="glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üí¨ Mis Chats
              </h3>
              <button onclick="buscarNuevoChat('alumno')" class="p-2 bg-primary/20 hover:bg-primary/30 rounded-lg transition-all" title="Nuevo chat">
                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              </button>
            </div>
            
            <div id="lista-chats-alumno" class="space-y-2 max-h-[400px] overflow-y-auto">
              <!-- Los chats se cargan din√°micamente -->
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl block mb-2 opacity-30">üí¨</span>
                <p class="text-sm">No tienes conversaciones</p>
                <button onclick="buscarNuevoChat('alumno')" class="mt-3 text-xs text-primary hover:underline">Iniciar un chat</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         DISCIPLINA DEL ALUMNO
      ===================================================== -->
      <div id="disciplina-alumno" class="content-section hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Resumen de puntos -->
          <div class="lg:col-span-1 space-y-6">
            <!-- Tarjeta de puntos -->
            <div class="glass rounded-2xl p-6 text-center">
              <div class="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-success to-primary flex items-center justify-center mb-4">
                <span class="text-3xl font-bold text-white" id="alumno-puntos-total">0</span>
              </div>
              <h3 class="text-lg font-semibold text-text-main">Puntos de Conducta</h3>
              <p class="text-sm text-text-muted mt-1">Tu puntaje actual</p>
              
              <div class="mt-4 grid grid-cols-2 gap-3">
                <div class="p-3 bg-success/10 rounded-xl">
                  <p class="text-xl font-bold text-success" id="alumno-meritos">0</p>
                  <p class="text-xs text-text-muted">M√©ritos</p>
                </div>
                <div class="p-3 bg-danger/10 rounded-xl">
                  <p class="text-xl font-bold text-danger" id="alumno-demeritos">0</p>
                  <p class="text-xs text-text-muted">Dem√©ritos</p>
                </div>
              </div>
            </div>

            <!-- Citatorios pendientes -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üìã Citatorios Pendientes
              </h3>
              <div id="citatorios-alumno" class="space-y-3">
                <div class="text-center py-4 text-text-muted">
                  <span class="text-3xl opacity-30">‚úÖ</span>
                  <p class="text-sm mt-2">Sin citatorios pendientes</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Historial de reportes -->
          <div class="lg:col-span-2 glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìú Mi Historial Disciplinario
              </h3>
              <select id="filtro-disciplina-alumno" class="text-sm bg-surface-light border border-border-subtle rounded-lg px-3 py-1.5 text-text-muted focus:outline-none">
                <option value="todos">Todos</option>
                <option value="positivo">Positivos</option>
                <option value="negativo">Negativos</option>
              </select>
            </div>
            
            <div id="historial-disciplina-alumno" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
              <div class="text-center py-12 text-text-muted">
                <span class="text-5xl block mb-3 opacity-30">üõ°Ô∏è</span>
                <p>No hay reportes en tu historial</p>
                <p class="text-xs mt-1">¬°Excelente comportamiento!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="panel-profesor" class="relative px-4 lg:px-8 py-6 lg:py-8 pb-20" style="display:none;">
      <!-- Bot√≥n oculto Panel CBTis -->
      <button id="btnAbrirPanelCBTis" class="hidden fixed top-4 right-4 z-50 w-10 h-10 rounded-full bg-surface-light/80 text-text-muted hover:text-primary transition-all">‚öôÔ∏è</button>

      <!-- Header con perfil -->
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-8">
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-text-main">Panel del Profesor</h1>
          <p class="text-text-muted mt-1">Gestiona asistencias y genera tu c√≥digo</p>
        </div>
        <div class="flex items-center gap-4 p-4 glass rounded-2xl">
          <div class="w-14 h-14 rounded-full bg-gradient-to-br from-accent to-primary flex items-center justify-center text-white font-bold text-xl">
            <span id="profesor-avatar">P</span>
          </div>
          <div>
            <p class="font-semibold text-text-main" id="profesor-perfil-nombre">Nombre Profesor</p>
            <p class="text-text-muted text-sm" id="profesor-perfil-materias">Materias</p>
          </div>
        </div>
      </div>

      <!-- =====================================================
         DASHBOARD DEL PROFESOR
      ===================================================== -->
      <div id="dashboard-profesor" class="content-section">
        <!-- Tarjetas de estad√≠sticas del d√≠a -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <!-- Clases Hoy -->
          <div class="glass rounded-2xl p-5 border-l-4 border-accent card-animate">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Clases Hoy</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="prof-stat-clases">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center">
                <span class="text-2xl">üìö</span>
              </div>
            </div>
            <p class="text-xs text-accent mt-2" id="prof-stat-clases-trend">Sin clases registradas</p>
          </div>

          <!-- Alumnos Atendidos -->
          <div class="glass rounded-2xl p-5 border-l-4 border-primary card-animate" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Alumnos Hoy</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="prof-stat-alumnos">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
                <span class="text-2xl">üéì</span>
              </div>
            </div>
            <p class="text-xs text-primary mt-2" id="prof-stat-alumnos-trend">Sin registros</p>
          </div>

          <!-- Promedio Asistencia -->
          <div class="glass rounded-2xl p-5 border-l-4 border-success card-animate" style="animation-delay: 0.2s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Asistencia</p>
                <p class="text-3xl font-bold text-text-main mt-1"><span id="prof-stat-asistencia">0</span>%</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-success/20 flex items-center justify-center">
                <span class="text-2xl">‚úÖ</span>
              </div>
            </div>
            <p class="text-xs text-success mt-2">Promedio del d√≠a</p>
          </div>

          <!-- Puntualidad -->
          <div class="glass rounded-2xl p-5 border-l-4 border-warning card-animate" style="animation-delay: 0.3s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Puntualidad</p>
                <p class="text-3xl font-bold text-text-main mt-1"><span id="prof-stat-puntualidad">0</span>%</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-warning/20 flex items-center justify-center">
                <span class="text-2xl">‚è∞</span>
              </div>
            </div>
            <p class="text-xs text-warning mt-2">Llegaron a tiempo</p>
          </div>
        </div>

        <!-- Grid principal -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
          <!-- Gr√°fica de asistencia semanal -->
          <div class="xl:col-span-2 glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìà Asistencia Semanal
              </h3>
              <span class="text-xs text-text-muted bg-surface-light px-3 py-1 rounded-full">√öltimos 7 d√≠as</span>
            </div>
            <div style="position: relative; height: 220px; width: 100%;">
              <canvas id="prof-grafica-semanal"></canvas>
            </div>
          </div>

          <!-- Indicadores de puntualidad -->
          <div class="glass rounded-2xl p-6 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üèÜ Top Puntualidad
            </h3>
            <div id="prof-top-puntualidad" class="space-y-3">
              <!-- Se llena din√°micamente -->
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl block mb-2 opacity-30">üèÜ</span>
                <p class="text-sm">Sin datos de puntualidad</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Segunda fila -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <!-- Pr√≥ximas clases / Horario -->
          <div class="glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìÖ Mis Clases de Hoy
              </h3>
              <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-success"></span>
              </span>
            </div>
            <div id="prof-clases-hoy" class="space-y-3 max-h-[280px] overflow-y-auto">
              <!-- Se llena din√°micamente -->
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl block mb-2 opacity-30">üìÖ</span>
                <p class="text-sm">No hay clases programadas</p>
              </div>
            </div>
          </div>

          <!-- Actividad reciente -->
          <div class="glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                ‚ö° Actividad Reciente
              </h3>
              <button onclick="cargarActividadProfesor()" class="text-xs text-primary hover:underline">Actualizar</button>
            </div>
            <div id="prof-actividad-reciente" class="space-y-2 max-h-[280px] overflow-y-auto">
              <!-- Se llena din√°micamente -->
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl block mb-2 opacity-30">‚ö°</span>
                <p class="text-sm">Sin actividad reciente</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Acciones r√°pidas -->
        <div class="mt-6 glass rounded-2xl p-6 card-animate">
          <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
            üöÄ Acciones R√°pidas
          </h3>
          <div class="flex flex-wrap gap-3">
            <button onclick="document.querySelector('[data-section=escaner-profesor]').click()" class="py-3 px-5 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/></svg>
              Iniciar Escaneo
            </button>
            <button onclick="document.querySelector('[data-section=clase-activa]').click()" class="py-3 px-5 bg-success/20 hover:bg-success/30 text-success rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
              Nueva Clase
            </button>
            <button onclick="exportarMisRegistros()" class="py-3 px-5 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Exportar Registros
            </button>
            <button onclick="document.querySelector('[data-section=historial-profesor]').click()" class="py-3 px-5 bg-warning/20 hover:bg-warning/30 text-warning rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              Ver Historial
            </button>
          </div>
        </div>
      </div>

      <!-- =====================================================
         HISTORIAL DEL PROFESOR
      ===================================================== -->
      <div id="historial-profesor" class="content-section hidden">
        <div class="glass rounded-2xl p-6 mb-6">
          <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
              üìã Historial de Clases
            </h3>
            <div class="flex gap-3">
              <input type="date" id="filtro-historial-profesor" class="px-4 py-2 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-accent">
              <button onclick="exportarHistorialProfesor()" class="py-2 px-4 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                Exportar
              </button>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left text-text-muted text-sm border-b border-border-subtle">
                  <th class="pb-3 px-2 font-medium">Fecha</th>
                  <th class="pb-3 px-2 font-medium">Aula</th>
                  <th class="pb-3 px-2 font-medium">Grupo</th>
                  <th class="pb-3 px-2 font-medium">Turno</th>
                  <th class="pb-3 px-2 font-medium">Alumnos</th>
                  <th class="pb-3 px-2 font-medium">Asistencia</th>
                  <th class="pb-3 px-2 font-medium">Estado</th>
                </tr>
              </thead>
              <tbody id="tabla-historial-profesor" class="text-sm">
                <tr>
                  <td colspan="7" class="py-8 text-center text-text-muted">
                    <span class="text-4xl block mb-2 opacity-30">üìã</span>
                    <p>No hay registros en el historial</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Secci√≥n: Generador QR Profesor (Auto-generado) -->
      <div id="generador-qr-profesor" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <!-- Info del profesor -->
          <div class="glass rounded-2xl p-6 lg:p-8 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-6 flex items-center gap-2">
              <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              Tu Informaci√≥n
            </h3>
            
            <!-- Datos del profesor logueado -->
            <div class="space-y-4">
              <div class="flex items-center gap-4 p-4 bg-surface-light/50 rounded-xl">
                <div id="avatar-profesor-qr" class="w-16 h-16 rounded-full bg-gradient-to-br from-accent to-primary flex items-center justify-center text-white text-xl font-bold">
                  --
                </div>
                <div>
                  <p id="nombre-profesor-qr" class="text-lg font-bold text-text-main">Cargando...</p>
                  <p id="materias-profesor-qr" class="text-sm text-text-muted">--</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div class="p-4 bg-surface-light/30 rounded-xl">
                  <p class="text-xs text-text-muted mb-1">Tel√©fono</p>
                  <p id="telefono-profesor-qr" class="text-lg font-bold text-accent">--</p>
                </div>
                <div class="p-4 bg-surface-light/30 rounded-xl">
                  <p class="text-xs text-text-muted mb-1">Grupos</p>
                  <p id="grupos-profesor-qr" class="text-lg font-bold text-text-main">--</p>
                </div>
              </div>
            </div>

            <!-- Informaci√≥n de seguridad -->
            <div class="mt-6 p-4 bg-accent/10 border border-accent/20 rounded-xl">
              <h4 class="font-semibold text-accent flex items-center gap-2 mb-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                C√≥digo Din√°mico Seguro
              </h4>
              <p class="text-sm text-text-muted">
                Tu c√≥digo QR se regenera cada <strong class="text-accent">30 segundos</strong> para mayor seguridad.
              </p>
            </div>

            <!-- Instrucciones -->
            <div class="mt-4 p-4 bg-surface-light/30 rounded-xl">
              <h4 class="font-semibold text-text-main mb-2">üìã C√≥mo iniciar clase</h4>
              <ol class="text-sm text-text-muted space-y-1 list-decimal list-inside">
                <li>Escanea tu QR en el lector del sal√≥n</li>
                <li>Configura los datos de la clase</li>
                <li>Los alumnos podr√°n escanearse</li>
              </ol>
            </div>
          </div>

          <!-- QR Preview -->
          <div class="glass rounded-2xl p-6 lg:p-8 card-animate flex flex-col items-center justify-center">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              Tu C√≥digo QR
              <span class="ml-2 px-2 py-0.5 bg-success/20 text-success text-xs rounded-full flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                Din√°mico
              </span>
            </h3>
            
            <div class="relative">
              <div id="prof-qrcode" class="w-52 h-52 bg-white rounded-2xl flex items-center justify-center mb-2 transition-all duration-300 shadow-lg">
                <div class="text-center text-gray-400">
                  <svg class="w-12 h-12 mx-auto mb-2 opacity-50 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
                  <span class="text-sm">Generando...</span>
                </div>
              </div>
              <div class="absolute -top-2 -right-2 w-8 h-8 bg-success rounded-full flex items-center justify-center shadow-lg" id="qr-security-badge-profesor" style="display: none;">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              </div>
            </div>
            
            <svg id="prof-barcode" class="mt-2 max-w-full"></svg>
            
            <div id="qr-timer-profesor" class="mt-3 text-center w-full">
              <div class="flex items-center justify-center gap-2 p-2 rounded-lg bg-accent/10 text-accent">
                <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span class="text-sm">Generando c√≥digo...</span>
              </div>
            </div>
            
            <button onclick="descargarQRProfesor()" class="mt-4 py-3 px-8 bg-success hover:bg-success/80 rounded-xl text-white font-semibold transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Descargar QR
            </button>
          </div>
        </div>
      </div>

      <!-- =====================================================
         CLASE ACTIVA DEL PROFESOR
      ===================================================== -->
      <div id="clase-activa" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          
          <!-- Panel Principal de Clase -->
          <div class="xl:col-span-2 space-y-6">
            
            <!-- Estado de Clase Activa -->
            <div id="clase-activa-estado" class="glass rounded-2xl p-6 lg:p-8">
              <!-- Se llena din√°micamente -->
              <div class="text-center py-12">
                <span class="text-6xl block mb-4">üìö</span>
                <h3 class="text-xl font-bold text-text-main mb-2">No hay clase activa</h3>
                <p class="text-text-muted mb-6">Inicia una nueva clase para comenzar a registrar asistencia</p>
                <button onclick="iniciarNuevaClaseRapido()" class="py-3 px-8 bg-primary hover:bg-primary-dark text-white rounded-xl font-semibold transition-all flex items-center gap-2 mx-auto">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                  Iniciar Nueva Clase
                </button>
              </div>
            </div>

            <!-- Lista de Alumnos en Clase -->
            <div id="clase-activa-alumnos" class="glass rounded-2xl p-6 hidden">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                  üë• Alumnos en Clase
                  <span id="clase-activa-contador" class="text-sm bg-primary/20 text-primary px-3 py-1 rounded-full">0</span>
                </h3>
                <div class="flex gap-2">
                  <button onclick="togglePaseLista()" class="py-2 px-4 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl text-sm font-medium transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                    Pase de Lista
                  </button>
                  <button onclick="exportarAsistenciaClase()" class="py-2 px-4 bg-success/20 hover:bg-success/30 text-success rounded-xl text-sm font-medium transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    Exportar
                  </button>
                </div>
              </div>
              
              <div id="clase-activa-lista-alumnos" class="space-y-2 max-h-[400px] overflow-y-auto">
                <!-- Se llena din√°micamente -->
              </div>
            </div>
          </div>

          <!-- Panel Lateral -->
          <div class="space-y-6">
            
            <!-- Informaci√≥n de la Clase -->
            <div id="clase-activa-info" class="glass rounded-2xl p-6 hidden">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üìã Informaci√≥n
              </h3>
              <div class="space-y-3" id="clase-activa-info-content">
                <!-- Se llena din√°micamente -->
              </div>
            </div>

            <!-- Resumen R√°pido -->
            <div id="clase-activa-resumen" class="glass rounded-2xl p-6 hidden">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üìä Resumen
              </h3>
              <div class="grid grid-cols-2 gap-3">
                <div class="bg-success/10 rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-success" id="clase-resumen-presentes">0</p>
                  <p class="text-xs text-text-muted">Presentes</p>
                </div>
                <div class="bg-warning/10 rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-warning" id="clase-resumen-bano">0</p>
                  <p class="text-xs text-text-muted">En Ba√±o</p>
                </div>
                <div class="bg-primary/10 rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-primary" id="clase-resumen-tardanzas">0</p>
                  <p class="text-xs text-text-muted">Tardanzas</p>
                </div>
                <div class="bg-danger/10 rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-danger" id="clase-resumen-ausentes">0</p>
                  <p class="text-xs text-text-muted">Ausentes</p>
                </div>
              </div>
            </div>

            <!-- Acciones de Clase -->
            <div id="clase-activa-acciones" class="glass rounded-2xl p-6 hidden">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                ‚ö° Acciones
              </h3>
              <div class="space-y-3">
                <button onclick="abrirEscanerDesdeClase()" class="w-full py-3 px-4 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
                  Escanear Alumno
                </button>
                <button onclick="registrarAlumnoManual()" class="w-full py-3 px-4 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                  Registrar Manual
                </button>
                <button onclick="finalizarClaseActiva()" class="w-full py-3 px-4 bg-danger/20 hover:bg-danger/30 text-danger rounded-xl font-medium transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/></svg>
                  Finalizar Clase
                </button>
              </div>
            </div>

            <!-- Cron√≥metro de Ba√±o -->
            <div id="clase-activa-cronometro" class="glass rounded-2xl p-6 hidden">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üöΩ Alumnos en Ba√±o
              </h3>
              <div id="lista-alumnos-bano" class="space-y-3">
                <!-- Se llena din√°micamente -->
                <p class="text-text-muted text-sm text-center py-4">Ning√∫n alumno en ba√±o</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Secci√≥n: Esc√°ner -->
      <div id="escaner-profesor" class="content-section hidden mt-8">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          <!-- Esc√°ner -->
          <div class="xl:col-span-2 glass rounded-2xl p-6 lg:p-8 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-6 flex items-center gap-2">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
              Esc√°ner de Alumnos
            </h3>

            <div id="panel-aviso" class="mb-6 p-4 rounded-xl bg-surface-light border border-border-subtle text-text-muted text-center">
              Por favor, registre su QR o c√≥digo de barras
            </div>

            <div id="qr-reader" class="w-full max-w-md mx-auto aspect-square bg-surface-light border-2 border-primary/30 rounded-2xl overflow-hidden"></div>
            <p id="prof-scan-status" class="text-text-muted text-center mt-4">Apunta el QR del alumno</p>

            <div class="flex flex-wrap justify-center gap-4 mt-6">
              <button onclick="activarModoCamara()" class="py-3 px-6 btn-primary rounded-xl text-white font-semibold">
                üì∑ Activar C√°mara
              </button>
              <button onclick="activarModoLector()" class="py-3 px-6 bg-surface-light hover:bg-surface border border-border-subtle rounded-xl text-text-main font-semibold transition-all">
                üîå Activar Lector QR
              </button>
            </div>

            <input id="input-lector" type="text" class="fixed -top-20 -left-20 opacity-0 pointer-events-none">
          </div>

          <!-- Lista de escaneados -->
          <div class="glass rounded-2xl p-6 card-animate">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center justify-between">
              <span class="flex items-center gap-2">
                <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Escaneados
              </span>
              <span class="text-sm text-text-muted bg-surface-light px-3 py-1 rounded-full" id="contador-escaneados">0</span>
            </h3>
            
            <div id="lista-escaneados" class="space-y-2 max-h-[400px] overflow-y-auto">
              <!-- Items din√°micos -->
            </div>

            <div class="flex gap-2 mt-4">
              <button id="btn-limpiar-overlay" class="flex-1 py-2 px-4 bg-danger/20 hover:bg-danger/30 text-danger rounded-xl text-sm font-medium transition-all">
                üßπ Limpiar
              </button>
              <button id="btn-finalizar-clase" class="flex-1 py-2 px-4 bg-success/20 hover:bg-success/30 text-success rounded-xl text-sm font-medium transition-all">
                üèÅ Finalizar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         COMUNICACI√ìN DEL PROFESOR
      ===================================================== -->
      <div id="comunicacion-profesor" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          <!-- Panel de Avisos -->
          <div class="xl:col-span-2 space-y-6">
            <!-- Crear nuevo aviso -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                ‚úèÔ∏è Crear Nuevo Aviso
              </h3>
              <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-text-muted text-sm mb-2">T√≠tulo del aviso</label>
                    <input type="text" id="aviso-titulo" placeholder="Ej: Tarea para el lunes"
                           class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary transition-all">
                  </div>
                  <div>
                    <label class="block text-text-muted text-sm mb-2">Destinatarios</label>
                    <select id="aviso-destinatarios" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-primary transition-all">
                      <option value="">Seleccionar grupo...</option>
                      <option value="todos">Todos mis grupos</option>
                      <option value="1A">1¬∞A</option>
                      <option value="1B">1¬∞B</option>
                      <option value="2A">2¬∞A</option>
                      <option value="2B">2¬∞B</option>
                      <option value="3A">3¬∞A</option>
                      <option value="3B">3¬∞B</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label class="block text-text-muted text-sm mb-2">Mensaje</label>
                  <textarea id="aviso-mensaje" rows="3" placeholder="Escribe el contenido del aviso..."
                            class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary transition-all resize-none"></textarea>
                </div>
                <div class="flex items-center justify-between">
                  <label class="flex items-center gap-2 text-sm text-text-muted cursor-pointer">
                    <input type="checkbox" id="aviso-importante" class="w-4 h-4 rounded border-border-subtle bg-surface-light text-primary focus:ring-primary">
                    <span>Marcar como importante</span>
                  </label>
                  <button onclick="publicarAviso()" class="py-2 px-6 btn-primary rounded-xl text-white font-medium transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                    Publicar
                  </button>
                </div>
              </div>
            </div>

            <!-- Mis avisos publicados -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                  üì¢ Mis Avisos Publicados
                </h3>
                <span class="text-xs text-text-muted" id="contador-mis-avisos">0 avisos</span>
              </div>
              
              <div id="lista-mis-avisos" class="space-y-3 max-h-[350px] overflow-y-auto pr-2">
                <div class="text-center py-8 text-text-muted">
                  <span class="text-4xl block mb-2 opacity-30">üì¢</span>
                  <p class="text-sm">No has publicado avisos</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel de Chats -->
          <div class="space-y-6">
            <!-- Lista de chats -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                  üí¨ Mis Chats
                </h3>
                <button onclick="buscarNuevoChat('profesor')" class="p-2 bg-primary/20 hover:bg-primary/30 rounded-lg transition-all" title="Nuevo chat">
                  <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
              </div>
              
              <div id="lista-chats-profesor" class="space-y-2 max-h-[300px] overflow-y-auto">
                <div class="text-center py-8 text-text-muted">
                  <span class="text-4xl block mb-2 opacity-30">üí¨</span>
                  <p class="text-sm">No tienes conversaciones</p>
                </div>
              </div>
            </div>

            <!-- Avisos institucionales -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üè´ Avisos Institucionales
              </h3>
              <div id="lista-avisos-institucionales-profesor" class="space-y-3 max-h-[250px] overflow-y-auto pr-2">
                <div class="text-center py-6 text-text-muted">
                  <span class="text-3xl block mb-2 opacity-30">üè´</span>
                  <p class="text-xs">Sin avisos de la instituci√≥n</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         REPORTAR INCIDENCIA (PROFESOR)
      ===================================================== -->
      <div id="reportar-profesor" class="content-section hidden">
        <div class="max-w-4xl mx-auto">
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-semibold text-text-main mb-6 flex items-center gap-2">
              ‚ö†Ô∏è Reportar Incidencia
            </h3>
            
            <div class="space-y-6">
              <!-- Buscar alumno -->
              <div>
                <label class="block text-text-muted text-sm mb-2">Buscar Alumno</label>
                <input type="text" id="buscar-alumno-reporte" placeholder="Nombre o n√∫mero de control..."
                       class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary"
                       oninput="buscarAlumnoReporte(this.value)">
                <div id="resultados-alumno-reporte" class="mt-2 hidden max-h-48 overflow-y-auto bg-surface rounded-xl border border-border-subtle"></div>
                <div id="alumno-seleccionado-reporte" class="mt-3 hidden p-3 bg-primary/10 rounded-xl flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-bold" id="avatar-alumno-reporte">A</div>
                    <div>
                      <p class="font-medium text-text-main" id="nombre-alumno-reporte">Nombre del alumno</p>
                      <p class="text-xs text-text-muted" id="info-alumno-reporte">Grado - Control</p>
                    </div>
                  </div>
                  <button onclick="limpiarAlumnoReporte()" class="p-1 hover:bg-surface-light rounded-full">
                    <svg class="w-5 h-5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                  </button>
                </div>
              </div>

              <!-- Tipo de reporte -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-text-muted text-sm mb-2">Tipo de Reporte</label>
                  <select id="tipo-reporte" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-primary" onchange="actualizarCategoriasReporte()">
                    <option value="negativo">‚ö†Ô∏è Negativo (Falta)</option>
                    <option value="positivo">‚≠ê Positivo (M√©rito)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-text-muted text-sm mb-2">Categor√≠a</label>
                  <select id="categoria-reporte" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-primary">
                    <option value="">Seleccionar...</option>
                    <option value="conducta">Mala conducta en clase</option>
                    <option value="uniforme">Falta de uniforme</option>
                    <option value="tarea">No entreg√≥ tarea</option>
                    <option value="respeto">Falta de respeto</option>
                    <option value="pelea">Pelea o agresi√≥n</option>
                    <option value="celular">Uso de celular</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
              </div>

              <!-- Gravedad -->
              <div>
                <label class="block text-text-muted text-sm mb-2">Gravedad</label>
                <div class="flex gap-3">
                  <label class="flex-1 cursor-pointer">
                    <input type="radio" name="gravedad-reporte" value="leve" class="hidden peer" checked>
                    <div class="p-3 rounded-xl border-2 border-border-subtle peer-checked:border-warning peer-checked:bg-warning/10 text-center transition-all">
                      <span class="text-2xl">üòê</span>
                      <p class="text-sm text-text-main mt-1">Leve</p>
                      <p class="text-xs text-text-muted">-5 pts</p>
                    </div>
                  </label>
                  <label class="flex-1 cursor-pointer">
                    <input type="radio" name="gravedad-reporte" value="moderada" class="hidden peer">
                    <div class="p-3 rounded-xl border-2 border-border-subtle peer-checked:border-orange-500 peer-checked:bg-orange-500/10 text-center transition-all">
                      <span class="text-2xl">üò†</span>
                      <p class="text-sm text-text-main mt-1">Moderada</p>
                      <p class="text-xs text-text-muted">-15 pts</p>
                    </div>
                  </label>
                  <label class="flex-1 cursor-pointer">
                    <input type="radio" name="gravedad-reporte" value="grave" class="hidden peer">
                    <div class="p-3 rounded-xl border-2 border-border-subtle peer-checked:border-danger peer-checked:bg-danger/10 text-center transition-all">
                      <span class="text-2xl">üò°</span>
                      <p class="text-sm text-text-main mt-1">Grave</p>
                      <p class="text-xs text-text-muted">-30 pts</p>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Descripci√≥n -->
              <div>
                <label class="block text-text-muted text-sm mb-2">Descripci√≥n del incidente</label>
                <textarea id="descripcion-reporte" rows="3" placeholder="Describe lo que sucedi√≥..."
                          class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary resize-none"></textarea>
              </div>

              <!-- Opciones adicionales -->
              <div class="flex flex-wrap gap-4">
                <label class="flex items-center gap-2 text-sm text-text-muted cursor-pointer">
                  <input type="checkbox" id="reporte-citar-padres" class="w-4 h-4 rounded border-border-subtle bg-surface-light text-danger focus:ring-danger">
                  <span>Solicitar cita con padres</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-text-muted cursor-pointer">
                  <input type="checkbox" id="reporte-notificar" checked class="w-4 h-4 rounded border-border-subtle bg-surface-light text-primary focus:ring-primary">
                  <span>Notificar a prefectura</span>
                </label>
              </div>

              <!-- Bot√≥n enviar -->
              <div class="flex justify-end gap-3">
                <button onclick="limpiarFormularioReporte()" class="py-3 px-6 bg-surface-light hover:bg-surface-light/70 text-text-muted rounded-xl font-medium transition-all">
                  Cancelar
                </button>
                <button onclick="enviarReporte()" class="py-3 px-6 bg-gradient-to-r from-warning to-danger hover:opacity-90 text-white rounded-xl font-medium transition-all flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                  Enviar Reporte
                </button>
              </div>
            </div>
          </div>

          <!-- Mis reportes recientes -->
          <div class="glass rounded-2xl p-6 mt-6">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üìã Mis Reportes Recientes
            </h3>
            <div id="mis-reportes-profesor" class="space-y-3 max-h-[300px] overflow-y-auto">
              <div class="text-center py-6 text-text-muted">
                <span class="text-3xl opacity-30">üìã</span>
                <p class="text-sm mt-2">No has enviado reportes</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mini overlay viejo (oculto, para compatibilidad) -->
      <div id="overlay-mini" class="hidden"></div>
      <ul id="lista-mini-alumnos" class="hidden"></ul>
    </section>

    <!-- =====================================================
       PANEL ADMIN
    ===================================================== -->
    <section id="panel-admin" class="relative px-4 lg:px-8 py-6 lg:py-8 pb-20" style="display:none;">
      <!-- Header con perfil -->
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-8">
        <div>
          <h1 class="text-2xl lg:text-3xl font-bold text-text-main">Panel de Administraci√≥n</h1>
          <p class="text-text-muted mt-1">Gestiona usuarios, registros y estad√≠sticas</p>
        </div>
        <div class="flex items-center gap-4 p-4 glass rounded-2xl">
          <div class="w-14 h-14 rounded-full bg-gradient-to-br from-warning to-danger flex items-center justify-center text-white font-bold text-xl">
            üëë
          </div>
          <div>
            <p class="font-semibold text-text-main">Administrador</p>
            <p class="text-text-muted text-sm">Acceso completo</p>
          </div>
        </div>
      </div>

      <!-- Dashboard Cards -->
      <div id="dashboard-admin" class="content-section">
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-8">
          <div class="glass rounded-2xl p-6 card-animate border-l-4 border-primary">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Total Alumnos</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="card-alumnos">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
                <span class="text-2xl">üéì</span>
              </div>
            </div>
          </div>
          <div class="glass rounded-2xl p-6 card-animate border-l-4 border-accent">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Total Profesores</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="card-profesores">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center">
                <span class="text-2xl">üë©‚Äçüè´</span>
              </div>
            </div>
          </div>
          <div class="glass rounded-2xl p-6 card-animate border-l-4 border-success">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Registros Hoy</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="card-registros-hoy">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-success/20 flex items-center justify-center">
                <span class="text-2xl">üìã</span>
              </div>
            </div>
          </div>
          <div class="glass rounded-2xl p-6 card-animate border-l-4 border-warning">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Usuarios Activos</p>
                <p class="text-3xl font-bold text-text-main mt-1" id="card-usuarios-activos">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-warning/20 flex items-center justify-center">
                <span class="text-2xl">‚úÖ</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Acciones r√°pidas -->
        <div class="glass rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-main mb-4">Acciones R√°pidas</h3>
          <div class="flex flex-wrap gap-3">
            <button id="btn-export-usuarios" class="py-3 px-5 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Exportar Usuarios
            </button>
            <button id="btn-export-registros" class="py-3 px-5 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Exportar Registros
            </button>
            <button id="btnExportarAccesos" class="py-3 px-5 bg-success/20 hover:bg-success/30 text-success rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Exportar Accesos
            </button>
          </div>
        </div>

        <div id="admin-log"></div>
      </div>

      <!-- Secci√≥n Usuarios -->
      <div id="usuarios-admin" class="content-section hidden">
        <div class="glass rounded-2xl p-6 card-animate">
          <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
              Gesti√≥n de Usuarios
            </h3>
            <input type="text" id="buscar-usuario" placeholder="üîç Buscar usuario..."
                   class="w-full lg:w-72 p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary input-glow transition-all">
          </div>

          <div class="overflow-x-auto">
            <table id="usuarios-table" class="w-full min-w-[800px]">
              <thead>
                <tr class="border-b border-border-subtle">
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Nombre</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Apellidos</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Tipo</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Grado</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Grupo</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Control</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Materias</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Tel√©fono</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">QR</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">C√≥digo</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Acciones</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border-subtle">
                <!-- Contenido din√°mico -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Secci√≥n Registros -->
      <div id="registros-admin" class="content-section hidden">
        <div class="glass rounded-2xl p-6 card-animate">
          <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
            <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
              <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
              Registros de Asistencia
            </h3>
            <div class="flex items-center gap-3">
              <label class="text-text-muted text-sm">Filtrar:</label>
              <input type="date" id="filtro-fecha" class="p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-accent">
              <input type="date" id="filtroFechaAccesos" class="p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-accent">
            </div>
          </div>

          <div class="overflow-x-auto max-h-[500px]">
            <table id="registros-table" class="w-full min-w-[600px]">
              <thead class="sticky top-0 bg-surface">
                <tr class="border-b border-border-subtle">
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Fecha</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Hora</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Tipo</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Nombre</th>
                  <th class="text-left py-4 px-4 text-text-muted font-medium text-sm">Profesor</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border-subtle">
                <!-- Contenido din√°mico -->
              </tbody>
            </table>
          </div>
        </div>

        <div id="exportarAccesosContainer" class="hidden"></div>
      </div>

      <!-- Secci√≥n Estad√≠sticas -->
      <div id="estadisticas-admin" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìä Asistencia Semanal
              </h3>
              <span class="text-xs text-text-muted bg-surface-light px-3 py-1 rounded-full">√öltimos 7 d√≠as</span>
            </div>
            <div style="position: relative; height: 200px; width: 100%;">
              <canvas id="grafica-asistencia"></canvas>
            </div>
            <div id="resumen-asistencia" class="mt-4 text-text-muted"></div>
          </div>

          <div class="glass rounded-2xl p-6 card-animate">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìö Clases Activas
              </h3>
              <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-success"></span>
              </span>
            </div>
            <div id="lista-clases-activas" class="space-y-2 max-h-[220px] overflow-y-auto"></div>
          </div>
        </div>

        <div id="panel-grafica-aula" class="hidden mt-6 glass rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 id="titulo-grafica-aula" class="text-lg font-semibold text-text-main">üìà Estad√≠sticas del Aula</h3>
            <button id="btn-volver-general" class="py-2 px-4 bg-surface-light hover:bg-surface border border-border-subtle rounded-xl text-text-main text-sm font-medium transition-all flex items-center gap-2">
              ‚¨Ö Volver
            </button>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div style="position: relative; height: 220px; width: 100%; max-width: 280px; margin: 0 auto;">
              <canvas id="grafica-aula"></canvas>
            </div>
            <div id="resumen-aula" class="text-text-muted"></div>
          </div>
        </div>

        <div id="panel-admin-realtime" class="hidden"></div>
        <div id="panel-clases-activas" class="hidden"></div>
      </div>

      <!-- Historial Admin -->
      <div id="historial-admin" class="mt-6 glass rounded-2xl p-6">
        <h4 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
          üìã √öltimos Escaneos
        </h4>
        <ul id="historial-list-admin" class="space-y-2 max-h-[300px] overflow-y-auto"></ul>
        <button id="export-historial-admin" class="mt-4 py-2 px-6 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all">
          ‚¨á Exportar Historial
        </button>
      </div>

      <!-- =====================================================
         COMUNICACI√ìN ADMIN
      ===================================================== -->
      <div id="comunicacion-admin" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          <!-- Crear aviso institucional -->
          <div class="xl:col-span-2 space-y-6">
            <div class="glass rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üè´ Crear Aviso Institucional
              </h3>
              <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-text-muted text-sm mb-2">T√≠tulo del aviso</label>
                    <input type="text" id="aviso-admin-titulo" placeholder="Ej: Suspensi√≥n de clases"
                           class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary transition-all">
                  </div>
                  <div>
                    <label class="block text-text-muted text-sm mb-2">Destinatarios</label>
                    <select id="aviso-admin-destinatarios" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main focus:outline-none focus:border-primary transition-all">
                      <option value="todos">Toda la comunidad</option>
                      <option value="alumnos">Solo Alumnos</option>
                      <option value="profesores">Solo Profesores</option>
                      <option value="padres">Solo Padres</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label class="block text-text-muted text-sm mb-2">Mensaje</label>
                  <textarea id="aviso-admin-mensaje" rows="4" placeholder="Escribe el contenido del aviso institucional..."
                            class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary transition-all resize-none"></textarea>
                </div>
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2 text-sm text-text-muted cursor-pointer">
                      <input type="checkbox" id="aviso-admin-importante" class="w-4 h-4 rounded border-border-subtle bg-surface-light text-danger focus:ring-danger">
                      <span class="text-danger">üö® Urgente</span>
                    </label>
                    <label class="flex items-center gap-2 text-sm text-text-muted cursor-pointer">
                      <input type="checkbox" id="aviso-admin-notificar" checked class="w-4 h-4 rounded border-border-subtle bg-surface-light text-primary focus:ring-primary">
                      <span>Notificar push</span>
                    </label>
                  </div>
                  <button onclick="publicarAvisoInstitucional()" class="py-2 px-6 bg-gradient-to-r from-warning to-danger hover:opacity-90 rounded-xl text-white font-medium transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
                    Publicar
                  </button>
                </div>
              </div>
            </div>

            <!-- Todos los avisos -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                  üì¢ Todos los Avisos
                </h3>
                <div class="flex gap-2">
                  <select id="filtro-avisos-admin" class="text-xs bg-surface-light border border-border-subtle rounded-lg px-3 py-1.5 text-text-muted focus:outline-none">
                    <option value="todos">Todos</option>
                    <option value="institucional">Institucionales</option>
                    <option value="profesor">De Profesores</option>
                  </select>
                </div>
              </div>
              
              <div id="lista-todos-avisos-admin" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                <div class="text-center py-8 text-text-muted">
                  <span class="text-4xl block mb-2 opacity-30">üì¢</span>
                  <p class="text-sm">No hay avisos publicados</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel lateral -->
          <div class="space-y-6">
            <!-- Estad√≠sticas de comunicaci√≥n -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
                üìä Estad√≠sticas
              </h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-primary/10 rounded-xl">
                  <span class="text-sm text-text-main">Avisos este mes</span>
                  <span class="text-lg font-bold text-primary" id="stat-avisos-mes">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-success/10 rounded-xl">
                  <span class="text-sm text-text-main">Chats activos</span>
                  <span class="text-lg font-bold text-success" id="stat-chats-activos">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-warning/10 rounded-xl">
                  <span class="text-sm text-text-main">Mensajes hoy</span>
                  <span class="text-lg font-bold text-warning" id="stat-mensajes-hoy">0</span>
                </div>
              </div>
            </div>

            <!-- Chats recientes -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                  üí¨ Chats Recientes
                </h3>
              </div>
              
              <div id="lista-chats-admin" class="space-y-2 max-h-[250px] overflow-y-auto">
                <div class="text-center py-6 text-text-muted">
                  <span class="text-3xl block mb-2 opacity-30">üí¨</span>
                  <p class="text-xs">Sin chats recientes</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         AN√ÅLISIS PREDICTIVO CON IA
      ===================================================== -->
      <div id="analisis-predictivo" class="content-section hidden">
        <div class="space-y-6">
          <!-- Header -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 class="text-2xl font-bold text-text-main flex items-center gap-3">
                <span class="text-3xl">ü§ñ</span>
                An√°lisis Predictivo
              </h1>
              <p class="text-text-muted mt-1">Detecci√≥n temprana de riesgo y patrones de asistencia</p>
            </div>
            <div class="flex gap-3">
              <button onclick="renderizarPanelAnalisis('contenedor-analisis')" class="py-2.5 px-5 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                Actualizar An√°lisis
              </button>
              <button onclick="exportarReporteRiesgo()" class="py-2.5 px-5 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Exportar Reporte
              </button>
            </div>
          </div>

          <!-- Contenedor del An√°lisis -->
          <div id="contenedor-analisis">
            <div class="text-center py-16 glass rounded-2xl">
              <span class="text-6xl block mb-4">ü§ñ</span>
              <h3 class="text-xl font-bold text-text-main mb-2">An√°lisis Predictivo</h3>
              <p class="text-text-muted mb-6">Haz clic en "Actualizar An√°lisis" para generar el reporte</p>
              <button onclick="renderizarPanelAnalisis('contenedor-analisis')" class="py-3 px-8 bg-primary hover:bg-primary-dark text-white rounded-xl font-semibold transition-all">
                Iniciar An√°lisis
              </button>
            </div>
          </div>

          <!-- Leyenda -->
          <div class="glass rounded-2xl p-4">
            <h4 class="text-sm font-medium text-text-main mb-3">üìä C√≥mo interpretar el Score de Riesgo</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
              <div class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-danger flex items-center justify-center text-white font-bold text-xs">60+</span>
                <div>
                  <p class="font-medium text-danger">Riesgo Alto</p>
                  <p class="text-xs text-text-muted">Requiere atenci√≥n inmediata</p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-warning flex items-center justify-center text-white font-bold text-xs">35-59</span>
                <div>
                  <p class="font-medium text-warning">Riesgo Medio</p>
                  <p class="text-xs text-text-muted">Monitorear de cerca</p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-full bg-success flex items-center justify-center text-white font-bold text-xs">&lt;35</span>
                <div>
                  <p class="font-medium text-success">Riesgo Bajo</p>
                  <p class="text-xs text-text-muted">Situaci√≥n estable</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =====================================================
         PANEL DE PREFECTURA
      ===================================================== -->
      <div id="prefectura" class="content-section hidden">
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
          <!-- Estad√≠sticas r√°pidas -->
          <div class="xl:col-span-4 grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="glass rounded-2xl p-5 border-l-4 border-danger">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-text-muted text-sm">Reportes Hoy</p>
                  <p class="text-3xl font-bold text-text-main" id="pref-stat-reportes-hoy">0</p>
                </div>
                <span class="text-3xl">üìù</span>
              </div>
            </div>
            <div class="glass rounded-2xl p-5 border-l-4 border-warning">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-text-muted text-sm">Permisos Pendientes</p>
                  <p class="text-3xl font-bold text-text-main" id="pref-stat-permisos">0</p>
                </div>
                <span class="text-3xl">üö™</span>
              </div>
            </div>
            <div class="glass rounded-2xl p-5 border-l-4 border-primary">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-text-muted text-sm">Citatorios Pendientes</p>
                  <p class="text-3xl font-bold text-text-main" id="pref-stat-citatorios">0</p>
                </div>
                <span class="text-3xl">üìã</span>
              </div>
            </div>
            <div class="glass rounded-2xl p-5 border-l-4 border-success">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-text-muted text-sm">Alumnos Sancionados</p>
                  <p class="text-3xl font-bold text-text-main" id="pref-stat-sancionados">0</p>
                </div>
                <span class="text-3xl">‚ö†Ô∏è</span>
              </div>
            </div>
          </div>

          <!-- Crear reporte r√°pido -->
          <div class="xl:col-span-2 glass rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              ‚ö° Reporte R√°pido
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-text-muted text-sm mb-2">Buscar Alumno</label>
                <input type="text" id="pref-buscar-alumno" placeholder="Nombre o control..."
                       class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary"
                       oninput="buscarAlumnoPrefectura(this.value)">
                <div id="pref-resultados-alumno" class="mt-2 hidden"></div>
                <div id="pref-alumno-seleccionado" class="mt-3 hidden"></div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-text-muted text-sm mb-2">Tipo</label>
                  <select id="pref-tipo-reporte" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main">
                    <option value="negativo">‚ö†Ô∏è Falta</option>
                    <option value="positivo">‚≠ê M√©rito</option>
                  </select>
                </div>
                <div>
                  <label class="block text-text-muted text-sm mb-2">Categor√≠a</label>
                  <select id="pref-categoria" class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main">
                    <option value="uniforme">Uniforme</option>
                    <option value="conducta">Conducta</option>
                    <option value="retardo">Retardo</option>
                    <option value="pelea">Pelea</option>
                    <option value="ayuda">Ayuda voluntaria</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
              </div>
              <div>
                <textarea id="pref-descripcion" rows="2" placeholder="Descripci√≥n breve..."
                          class="w-full p-3 rounded-xl bg-surface-light border border-border-subtle text-text-main placeholder-text-muted focus:outline-none focus:border-primary resize-none"></textarea>
              </div>
              <button onclick="crearReportePrefectura()" class="w-full py-3 btn-primary rounded-xl text-white font-medium">
                Crear Reporte
              </button>
            </div>
          </div>

          <!-- Reportes recientes -->
          <div class="xl:col-span-2 glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                üìù Reportes Recientes
              </h3>
              <button onclick="verTodosReportes()" class="text-xs text-primary hover:underline">Ver todos</button>
            </div>
            <div id="pref-reportes-recientes" class="space-y-3 max-h-[350px] overflow-y-auto pr-2">
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl opacity-30">üìù</span>
                <p class="text-sm mt-2">Sin reportes recientes</p>
              </div>
            </div>
          </div>

          <!-- Permisos de salida pendientes -->
          <div class="xl:col-span-2 glass rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üö™ Permisos de Salida Pendientes
            </h3>
            <div id="pref-permisos-pendientes" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl opacity-30">üö™</span>
                <p class="text-sm mt-2">Sin permisos pendientes</p>
              </div>
            </div>
            
            <div class="mt-4 pt-4 border-t border-border-subtle">
              <button onclick="abrirModalPermiso()" class="w-full py-2 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Nuevo Permiso de Salida
              </button>
            </div>
          </div>

          <!-- Citatorios -->
          <div class="xl:col-span-2 glass rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-text-main mb-4 flex items-center gap-2">
              üìã Citatorios Pendientes
            </h3>
            <div id="pref-citatorios-pendientes" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
              <div class="text-center py-8 text-text-muted">
                <span class="text-4xl opacity-30">üìã</span>
                <p class="text-sm mt-2">Sin citatorios pendientes</p>
              </div>
            </div>
            
            <div class="mt-4 pt-4 border-t border-border-subtle">
              <button onclick="abrirModalCitatorio()" class="w-full py-2 bg-warning/20 hover:bg-warning/30 text-warning rounded-xl font-medium transition-all flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Nuevo Citatorio
              </button>
            </div>
          </div>

          <!-- Alumnos con m√°s reportes -->
          <div class="xl:col-span-4 glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-text-main flex items-center gap-2">
                ‚ö†Ô∏è Alumnos con M√°s Reportes (Este Mes)
              </h3>
              <select id="pref-filtro-periodo" class="text-sm bg-surface-light border border-border-subtle rounded-lg px-3 py-1.5 text-text-muted">
                <option value="mes">Este mes</option>
                <option value="semestre">Este semestre</option>
                <option value="a√±o">Este a√±o</option>
              </select>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="text-left text-text-muted text-sm border-b border-border-subtle">
                    <th class="pb-3 font-medium">Alumno</th>
                    <th class="pb-3 font-medium">Grado</th>
                    <th class="pb-3 font-medium text-center">Reportes</th>
                    <th class="pb-3 font-medium text-center">Puntos</th>
                    <th class="pb-3 font-medium text-center">Estado</th>
                    <th class="pb-3 font-medium">Acciones</th>
                  </tr>
                </thead>
                <tbody id="pref-tabla-alumnos-reportes" class="text-sm">
                  <tr>
                    <td colspan="6" class="py-8 text-center text-text-muted">
                      <span class="text-3xl block mb-2 opacity-30">üìä</span>
                      Sin datos disponibles
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- =====================================================
       PANEL DE HORARIOS - ADMIN
    ===================================================== -->
    <section id="horarios-admin" class="content-section p-6 lg:p-8 hidden">
      <div class="space-y-6">
        <!-- Header -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 class="text-2xl font-bold text-text-main flex items-center gap-3">
              <span class="text-3xl">üìÖ</span>
              Gesti√≥n de Horarios
            </h1>
            <p class="text-text-muted mt-1">CBTis No. 001 - Ciclo Escolar 2025-2026</p>
          </div>
          <div class="flex gap-3">
            <button onclick="vincularProfesoresUI()" class="py-2.5 px-5 bg-primary/20 hover:bg-primary/30 text-primary rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
              Vincular Profesores
            </button>
            <button onclick="crearAsignacionesUI()" class="py-2.5 px-5 bg-accent/20 hover:bg-accent/30 text-accent rounded-xl font-medium transition-all flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
              Crear Asignaciones
            </button>
          </div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="glass rounded-2xl p-5 border-l-4 border-primary">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Profesores</p>
                <p class="text-3xl font-bold text-text-main" id="horarios-stat-profesores">0</p>
              </div>
              <span class="text-3xl">üë®‚Äçüè´</span>
            </div>
          </div>
          <div class="glass rounded-2xl p-5 border-l-4 border-success">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Vinculados</p>
                <p class="text-3xl font-bold text-text-main" id="horarios-stat-vinculados">0</p>
              </div>
              <span class="text-3xl">‚úÖ</span>
            </div>
          </div>
          <div class="glass rounded-2xl p-5 border-l-4 border-accent">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Asignaciones</p>
                <p class="text-3xl font-bold text-text-main" id="horarios-stat-asignaciones">0</p>
              </div>
              <span class="text-3xl">üìã</span>
            </div>
          </div>
          <div class="glass rounded-2xl p-5 border-l-4 border-warning">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-text-muted text-sm">Grupos</p>
                <p class="text-3xl font-bold text-text-main" id="horarios-stat-grupos">36</p>
              </div>
              <span class="text-3xl">üè´</span>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="glass rounded-2xl overflow-hidden">
          <div class="flex border-b border-border-subtle">
            <button class="horarios-tab active flex-1 py-4 px-6 text-center font-medium transition-all" data-tab="profesores">
              üë®‚Äçüè´ Profesores
            </button>
            <button class="horarios-tab flex-1 py-4 px-6 text-center font-medium transition-all text-text-muted hover:text-text-main" data-tab="asignaciones">
              üìã Asignaciones
            </button>
            <button class="horarios-tab flex-1 py-4 px-6 text-center font-medium transition-all text-text-muted hover:text-text-main" data-tab="grupos">
              üè´ Grupos
            </button>
            <button class="horarios-tab flex-1 py-4 px-6 text-center font-medium transition-all text-text-muted hover:text-text-main" data-tab="materias">
              üìö Materias
            </button>
          </div>

          <!-- Tab: Profesores -->
          <div id="tab-profesores" class="horarios-tab-content p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div class="relative flex-1 max-w-md">
                <input type="text" id="buscar-profesor-horarios" placeholder="Buscar profesor..." class="w-full py-3 px-4 pl-11 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main placeholder-text-muted focus:outline-none focus:border-primary/50">
                <svg class="w-5 h-5 text-text-muted absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              </div>
              <select id="filtro-turno-profesor" class="py-3 px-4 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main focus:outline-none focus:border-primary/50">
                <option value="">Todos los turnos</option>
                <option value="Matutino">Matutino</option>
                <option value="Vespertino">Vespertino</option>
              </select>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="text-left text-text-muted text-sm border-b border-border-subtle">
                    <th class="pb-4 font-medium">Profesor</th>
                    <th class="pb-4 font-medium">Iniciales</th>
                    <th class="pb-4 font-medium">Materia</th>
                    <th class="pb-4 font-medium">Grupos</th>
                    <th class="pb-4 font-medium">Turno</th>
                    <th class="pb-4 font-medium">Estado</th>
                    <th class="pb-4 font-medium text-right">Acciones</th>
                  </tr>
                </thead>
                <tbody id="tabla-profesores-horarios" class="text-sm">
                  <tr>
                    <td colspan="7" class="py-8 text-center text-text-muted">
                      <span class="text-3xl block mb-2">‚è≥</span>
                      Cargando profesores...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Asignaciones -->
          <div id="tab-asignaciones" class="horarios-tab-content p-6 hidden">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div class="relative flex-1 max-w-md">
                <input type="text" id="buscar-asignacion" placeholder="Buscar asignaci√≥n..." class="w-full py-3 px-4 pl-11 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main placeholder-text-muted focus:outline-none focus:border-primary/50">
                <svg class="w-5 h-5 text-text-muted absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              </div>
              <button onclick="abrirModalNuevaAsignacion()" class="py-2.5 px-5 bg-success/20 hover:bg-success/30 text-success rounded-xl font-medium transition-all flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                Nueva Asignaci√≥n
              </button>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="text-left text-text-muted text-sm border-b border-border-subtle">
                    <th class="pb-4 font-medium">Profesor</th>
                    <th class="pb-4 font-medium">Materia</th>
                    <th class="pb-4 font-medium">Grupo</th>
                    <th class="pb-4 font-medium">Turno</th>
                    <th class="pb-4 font-medium">Ciclo</th>
                    <th class="pb-4 font-medium text-right">Acciones</th>
                  </tr>
                </thead>
                <tbody id="tabla-asignaciones" class="text-sm">
                  <tr>
                    <td colspan="6" class="py-8 text-center text-text-muted">
                      <span class="text-3xl block mb-2">üìã</span>
                      No hay asignaciones creadas
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Grupos -->
          <div id="tab-grupos" class="horarios-tab-content p-6 hidden">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div class="flex gap-3">
                <select id="filtro-semestre-grupo" class="py-3 px-4 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main focus:outline-none focus:border-primary/50">
                  <option value="">Todos los semestres</option>
                  <option value="1">1¬∞ Semestre</option>
                  <option value="3">3¬∞ Semestre</option>
                  <option value="5">5¬∞ Semestre</option>
                </select>
                <select id="filtro-turno-grupo" class="py-3 px-4 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main focus:outline-none focus:border-primary/50">
                  <option value="">Todos los turnos</option>
                  <option value="Matutino">Matutino</option>
                  <option value="Vespertino">Vespertino</option>
                </select>
              </div>
            </div>

            <div id="grid-grupos" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
              <!-- Grupos se generan din√°micamente -->
            </div>
          </div>

          <!-- Tab: Materias -->
          <div id="tab-materias" class="horarios-tab-content p-6 hidden">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div class="relative flex-1 max-w-md">
                <input type="text" id="buscar-materia" placeholder="Buscar materia..." class="w-full py-3 px-4 pl-11 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main placeholder-text-muted focus:outline-none focus:border-primary/50">
                <svg class="w-5 h-5 text-text-muted absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              </div>
              <select id="filtro-tipo-materia" class="py-3 px-4 bg-surface-light/50 border border-border-subtle rounded-xl text-text-main focus:outline-none focus:border-primary/50">
                <option value="">Todas las materias</option>
                <option value="basica">B√°sicas</option>
                <option value="especialidad">Especialidad</option>
              </select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="grid-materias">
              <!-- Materias se generan din√°micamente -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Historial general -->
    <section id="historial" class="p-6 lg:p-8" style="display:none;">
      <div class="glass rounded-2xl p-6">
        <h2 class="text-xl font-bold text-text-main mb-6 flex items-center gap-2">
          üìã Historial de Escaneos
        </h2>
        <ul id="historial-list" class="space-y-2"></ul>
      </div>
    </section>

  </main>
</div>

<!-- =====================================================
   MINI OVERLAY DE ALUMNOS ESCANEADOS
===================================================== -->
<div id="overlay-mini" class="fixed right-5 bottom-5 w-80 max-h-[60vh] flex flex-col p-5 z-[9999] transition-all duration-300" style="
  display: none;
  background: rgba(17, 24, 39, 0.95);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(6, 182, 212, 0.3);
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
  font-family: 'Plus Jakarta Sans', sans-serif;
">
  <div class="flex items-center justify-between pb-3 mb-3 border-b border-white/10">
    <div class="flex items-center gap-2">
      <span class="text-lg">üìã</span>
      <span class="text-sm font-bold text-primary uppercase tracking-wide">Alumnos Escaneados</span>
    </div>
    <button id="mini-overlay-close" class="w-7 h-7 flex items-center justify-center rounded-lg bg-white/5 text-text-muted hover:text-white hover:bg-white/10 transition-all text-sm">‚úï</button>
  </div>
  
  <ul id="lista-mini-alumnos" class="flex flex-col gap-2 list-none p-0 m-0 overflow-y-auto max-h-[300px] mb-4"></ul>
  
  <div class="flex gap-2 mt-auto pt-3 border-t border-white/10">
    <button id="btn-limpiar-overlay" class="flex-1 py-2 px-4 rounded-xl text-sm font-semibold transition-all" style="
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    ">üßπ Limpiar</button>
    <button id="btn-finalizar-clase" class="flex-1 py-2 px-4 rounded-xl text-sm font-semibold transition-all" style="
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #6ee7b7;
    ">üèÅ Finalizar</button>
  </div>
</div>

<!-- MINI HOLO (alternativo) -->
<div id="mini-holo" class="fixed right-5 bottom-5 w-80 max-h-[55vh] flex flex-col gap-2.5 p-4 glass rounded-2xl overflow-y-auto z-[999999] opacity-0 translate-y-8 scale-95 transition-all duration-300" style="display: none;">
  <div id="mini-holo-title" class="text-sm font-bold text-primary uppercase tracking-wide pb-2 border-b border-border-subtle mb-1">
    Alumnos Escaneados
  </div>
  <ul id="lista-mini-holo" class="flex flex-col gap-2 list-none p-0 m-0"></ul>
  <button id="mini-holo-clear" class="bg-danger/20 border border-danger/30 text-danger py-2 px-4 rounded-xl cursor-pointer text-sm font-semibold mt-2 self-end transition-all hover:bg-danger/30">
    üßπ Limpiar
  </button>
</div>

<!-- =====================================================
   SCRIPTS
===================================================== -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Scripts de tu app -->
<script src="js/firebase-config.js"></script>
<script src="js/horarios.js"></script>
<script src="js/horarios-admin.js"></script>
<script src="js/analisis-predictivo.js"></script>

<!-- Sistema de voz IA -->
<script>
function speakIA(text) {
  if (!window.speechSynthesis) return;
  
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "es-MX";
  utter.rate = 1.05;
  utter.pitch = 1.05;
  utter.volume = 1;

  const voices = speechSynthesis.getVoices();
  const premium = voices.find(v =>
    v.name.includes("Google") ||
    v.name.includes("Microsoft") ||
    v.name.includes("Paulina") ||
    v.name.includes("Luciana")
  );
  if (premium) utter.voice = premium;

  speechSynthesis.cancel();
  setTimeout(() => speechSynthesis.speak(utter), 150);
}

// Cargar voces
if (window.speechSynthesis) {
  speechSynthesis.onvoiceschanged = () => {};
}
</script>

<script src="js/qr-dinamico.js"></script>
<script src="js/dom-elements.js"></script>
<script src="js/audios.js"></script>
<script src="js/auth-system.js"></script>
<script src="js/profesor-dashboard.js"></script>
<script src="js/alumno-dashboard.js"></script>
<script src="js/comunicacion.js"></script>
<script src="js/prefectura.js"></script>
<script src="js/qr-barcode.js"></script>
<script src="js/overlays.js"></script>

<!-- Script que SOBRESCRIBE mostrarMiniAlumno para nueva UI -->
<script>
// SOBRESCRIBIR la funci√≥n de overlays.js con la versi√≥n nueva UI
window.mostrarMiniAlumno = function(texto) {
  console.log('üìã mostrarMiniAlumno (nueva UI):', texto);
  
  const overlay = document.getElementById('overlay-mini');
  const lista = document.getElementById('lista-mini-alumnos');
  
  if (!overlay) {
    console.warn('‚ö†Ô∏è #overlay-mini no encontrado');
    return;
  }
  
  if (!lista) {
    console.warn('‚ö†Ô∏è #lista-mini-alumnos no encontrado');
    return;
  }
  
  // Mostrar el overlay
  overlay.style.display = 'flex';
  
  // Crear item de alumno con estilo nuevo
  const li = document.createElement('li');
  li.className = 'mini-alumno-item';
  li.style.cssText = `
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(30, 41, 59, 0.6);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    color: #f1f5f9;
    font-size: 0.85rem;
    animation: slideInRight 0.3s ease;
    list-style: none;
  `;
  
  // Crear el icono de check
  const checkIcon = document.createElement('span');
  checkIcon.style.cssText = `
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #10b981, #059669);
    border-radius: 50%;
    color: white;
    font-size: 0.7rem;
    font-weight: bold;
    flex-shrink: 0;
  `;
  checkIcon.textContent = '‚úì';
  
  // Crear el texto
  const textSpan = document.createElement('span');
  textSpan.style.cssText = `
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  `;
  textSpan.textContent = texto;
  
  li.appendChild(checkIcon);
  li.appendChild(textSpan);
  
  // Agregar al principio de la lista
  lista.prepend(li);
  
  // Limitar a 20 items
  while (lista.children.length > 20) {
    lista.removeChild(lista.lastChild);
  }
  
  console.log('‚úÖ Alumno agregado a la lista');
};

// Inicializar eventos del mini overlay
document.addEventListener('DOMContentLoaded', () => {
  // Cerrar mini overlay
  const closeBtn = document.getElementById('mini-overlay-close');
  if (closeBtn) {
    closeBtn.onclick = () => {
      const overlay = document.getElementById('overlay-mini');
      if (overlay) overlay.style.display = 'none';
    };
  }
  
  // Limpiar lista
  const limpiarBtn = document.getElementById('btn-limpiar-overlay');
  if (limpiarBtn) {
    limpiarBtn.onclick = () => {
      const lista = document.getElementById('lista-mini-alumnos');
      if (lista) lista.innerHTML = '';
    };
  }
  
  // Finalizar clase desde mini overlay
  const finalizarBtn = document.getElementById('btn-finalizar-clase');
  if (finalizarBtn) {
    finalizarBtn.onclick = async () => {
      if (typeof finalizarSesionClase === 'function') {
        const motivo = prompt('Motivo de finalizaci√≥n (opcional):') || '';
        await finalizarSesionClase(motivo);
        const overlay = document.getElementById('overlay-mini');
        if (overlay) overlay.style.display = 'none';
      }
    };
  }
});

console.log('‚úÖ mostrarMiniAlumno sobrescrita para nueva UI');
</script>
<script src="js/iniciar-clase.js?v=2"></script>
<script src="js/scanner.js"></script>
<script src="js/procesar-qr.js"></script>
<script src="js/admin-panel.js?v=2.1"></script>
<script src="js/admin-grafica.js"></script>
<script src="js/acceso-cbtis.js"></script>
<script src="js/main.js"></script>

<!-- Script de navegaci√≥n y UI -->
<script>
// Esperar a que el DOM est√© completamente cargado
document.addEventListener('DOMContentLoaded', () => {
  console.log('üöÄ DOM Cargado - Inicializando UI');
  
  // Elementos
  const sidebar = document.getElementById('sidebar');
  const sidebarOverlay = document.getElementById('sidebar-overlay');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const toggleSidebarBtn = document.getElementById('btn-toggle-sidebar');
  const toggleIcon = document.getElementById('toggle-icon');
  const mainContent = document.getElementById('main-content');
  const appLayout = document.getElementById('app-layout');
  
  // Funci√≥n para activar el layout cuando se muestra un panel
  window.activarLayoutPanel = function(panelId) {
    console.log('üéØ Activando layout para:', panelId);
    
    // Mostrar el layout principal
    if (appLayout) {
      appLayout.style.display = 'block';
      console.log('‚úÖ app-layout mostrado');
    }
    
    // Ocultar overlay de rol y login
    const overlayRol = document.getElementById('overlay-rol');
    const overlayLogin = document.getElementById('overlay-login');
    if (overlayRol) {
      overlayRol.style.display = 'none';
      console.log('‚úÖ overlay-rol ocultado');
    }
    if (overlayLogin) overlayLogin.classList.remove('show');
    
    // Configurar navegaci√≥n seg√∫n el rol
    document.querySelectorAll('.nav-alumno, .nav-profesor, .nav-admin, .nav-prefecto, .nav-prefecto-only').forEach(el => {
      el.style.display = 'none';
    });
    
    const sidebarRole = document.getElementById('sidebar-role');
    const sidebarAvatar = document.getElementById('sidebar-avatar');
    const mobileAvatar = document.getElementById('mobile-avatar');
    
    if (panelId === 'panel-alumno') {
      document.querySelectorAll('.nav-alumno').forEach(el => el.style.display = 'block');
      if (sidebarRole) sidebarRole.textContent = 'Alumno';
      if (sidebarAvatar) sidebarAvatar.textContent = 'A';
      if (mobileAvatar) mobileAvatar.textContent = 'A';
    } else if (panelId === 'panel-profesor') {
      document.querySelectorAll('.nav-profesor').forEach(el => el.style.display = 'block');
      if (sidebarRole) sidebarRole.textContent = 'Profesor';
      if (sidebarAvatar) sidebarAvatar.textContent = 'P';
      if (mobileAvatar) mobileAvatar.textContent = 'P';
    } else if (panelId === 'panel-admin') {
      document.querySelectorAll('.nav-admin').forEach(el => el.style.display = 'block');
      if (sidebarRole) sidebarRole.textContent = 'Administrador';
      if (sidebarAvatar) sidebarAvatar.textContent = 'üëë';
      if (mobileAvatar) mobileAvatar.textContent = 'üëë';
    } else if (panelId === 'panel-prefecto') {
      document.querySelectorAll('.nav-prefecto-only').forEach(el => el.style.display = 'block');
      if (sidebarRole) sidebarRole.textContent = 'Prefecto';
      if (sidebarAvatar) sidebarAvatar.textContent = 'üõ°Ô∏è';
      if (mobileAvatar) mobileAvatar.textContent = 'üõ°Ô∏è';
    }
  };
  
  // Observador para detectar cuando se muestra un panel (desde roles.js)
  const paneles = ['panel-alumno', 'panel-profesor', 'panel-admin'];
  
  paneles.forEach(panelId => {
    const panel = document.getElementById(panelId);
    if (panel) {
      console.log('üëÅÔ∏è Observando panel:', panelId);
      
      // Observar cambios en el style del panel
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'style') {
            const displayValue = panel.style.display;
            console.log('üîÑ Cambio detectado en', panelId, '- display:', displayValue);
            if (displayValue === 'block' || displayValue === 'flex') {
              // El panel se est√° mostrando, activar el layout
              window.activarLayoutPanel(panelId);
            }
          }
        });
      });
      
      observer.observe(panel, { attributes: true, attributeFilter: ['style'] });
    } else {
      console.warn('‚ö†Ô∏è Panel no encontrado:', panelId);
    }
  });
  
  // Mobile menu toggle
  if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('mobile-open');
      sidebarOverlay.classList.toggle('hidden');
    });
  }
  
  if (sidebarOverlay) {
    sidebarOverlay.addEventListener('click', () => {
      sidebar.classList.remove('mobile-open');
      sidebarOverlay.classList.add('hidden');
    });
  }
  
  // Desktop sidebar collapse
  if (toggleSidebarBtn) {
    toggleSidebarBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      if (mainContent) {
        mainContent.classList.toggle('lg:ml-20');
        mainContent.classList.toggle('lg:ml-64');
      }
      if (toggleIcon) {
        toggleIcon.style.transform = sidebar.classList.contains('collapsed') ? 'rotate(180deg)' : '';
      }
    });
  }
  
  // Navegaci√≥n entre secciones
  document.querySelectorAll('.nav-item[data-section]').forEach(item => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      const section = item.dataset.section;
      
      // Actualizar estado activo
      document.querySelectorAll('.nav-item').forEach(nav => {
        nav.classList.remove('bg-primary/20', 'text-primary');
        nav.classList.add('text-text-muted');
      });
      item.classList.remove('text-text-muted');
      item.classList.add('bg-primary/20', 'text-primary');
      
      // Mostrar secci√≥n correspondiente
      document.querySelectorAll('.content-section').forEach(sec => sec.classList.add('hidden'));
      const targetSection = document.getElementById(section);
      if (targetSection) {
        targetSection.classList.remove('hidden');
      }
      
      // Cerrar sidebar en mobile
      if (window.innerWidth < 1024) {
        sidebar.classList.remove('mobile-open');
        sidebarOverlay.classList.add('hidden');
      }
    });
  });
  
  // Bot√≥n Panel CBTis
  const btnCBTis = document.getElementById('btnAbrirPanelCBTis');
  if (btnCBTis) {
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'c') {
        btnCBTis.style.display = btnCBTis.style.display === 'none' ? 'block' : 'none';
      }
    });
    
    btnCBTis.addEventListener('click', () => {
      if (typeof InitPanelCBTis === 'function') {
        InitPanelCBTis();
      }
    });
  }
  
  // Input lector
  const inputLector = document.getElementById('input-lector');
  if (inputLector) {
    setInterval(() => {
      if (document.activeElement !== inputLector) {
        inputLector.focus();
      }
    }, 10000);
    
    inputLector.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const codigo = inputLector.value.trim();
        if (codigo) {
          console.log('‚úÖ Escaneado:', codigo);
          if (typeof manejarCodigo === 'function') manejarCodigo(codigo);
          inputLector.value = '';
        }
      }
    });
  }
  
  // Cerrar sesi√≥n
  const btnCerrar = document.getElementById('btn-cerrar-sesion');
  if (btnCerrar) {
    btnCerrar.addEventListener('click', () => {
      if (typeof cerrarSesion === 'function') {
        cerrarSesion();
      } else {
        location.reload();
      }
    });
  }
});
</script>

</body>
</html>
